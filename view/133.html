<!doctype html>
<html lang="zh-cn" >
<head>
    <meta charset="utf-8">
    <link rel="icon" href="data:image/ico;base64,aWNv">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://file.depy.ink/theme/docs/css/bootstrap.min.css?v=8280" rel="stylesheet">
    <link href="https://file.depy.ink/theme/docs/css/main.css?v=3525" rel="stylesheet">
    <script src="https://file.depy.ink/theme/docs/js/jquery.min.js"></script>
    <script src="https://file.depy.ink/theme/docs/js/bootstrap.min.js?v=4094"></script>
    <script src="https://file.depy.ink/theme/docs/js/functions.js?v=8141"></script>
    <script src="https://file.depy.ink/theme/docs/js/marked.min.js"></script>
    <link href="https://file.depy.ink/theme/docs/css/doc.css?v=4299" rel="stylesheet">
    <link rel="stylesheet" href="https://file.depy.ink/assets/editor/editormd/css/editormd.css?v=6567" />
    <script src="https://file.depy.ink/assets/editor/editormd/editormd.js"></script>
    <script src="https://file.depy.ink/assets/editor/editormd/lib/marked.min.js"></script>
    <script src="https://file.depy.ink/assets/editor/editormd/lib/prettify.min.js"></script>

    <script src="https://file.depy.ink/theme/docs/js/pjax.min.js"></script>
    


    <script src="https://file.depy.ink/theme/docs/js/lightbox-plus-jquery.min.js"> </script>
    <link href="https://file.depy.ink/theme/docs/css/lightbox.css?v=3328" rel="stylesheet"><title>Un1kHacking</title>
</head>

<body class="bg-light ready sticky" id="watermark">


             <nav class="navbar navbar-expand-lg navbar-light shadow-sm bg-white mybt2 sticky-top">
        <div class="container-fluid" style="max-width:1332px;">
            <a class="navbar-brand" href="/"><b class="">Depy's docs</b></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="/" >é¦–é¡µ</a>
                    </li>

                </ul>

            </div>
        </div>
    </nav>


<main>


<aside class="sidebar">
           <div class="sidebar-nav mt-2">
            <ul>
            <li>

 <p>é€†å‘åˆ†æ</p>
    <ul>
<li><a href="/view/86.html">âš™ï¸ ã€Xposed æ”¹æœºã€‘- åŸºç¡€ç¯å¢ƒå®‰è£…</a></li>
<li><a href="/view/81.html">ğŸ’» å®‰å“å†…è”æ±‡ç¼–å¼€å‘</a></li>
<li><a href="/view/76.html">ğŸ“‘ JNI ä½¿ç”¨åŸºç¡€</a></li>
<li><a href="/view/75.html">ğŸ“‘ IDA Debugger è°ƒè¯•å™¨ä½¿ç”¨</a></li>
<li><a href="/view/74.html">ğŸ’» std::stringå†…å­˜å¸ƒå±€</a></li>
<li><a href="/view/73.html">ğŸ’¼ Fridaä½œä¸š-20231114</a></li>
<li><a href="/view/65.html">ğŸ§® JSVMPæ‰§è¡Œæµç¨‹åˆ†æ</a></li>
    </ul>
 <p>DepyDocs</p>
    <ul>
<li><a href="/view/122.html">ğŸ“‘ DepyDocs</a></li>
<li><a href="/view/120.html">ğŸ“‘  Un1kMsgä½¿ç”¨</a></li>
<li><a href="/view/114.html">ğŸ“‘ è”ç³»æ–¹å¼</a></li>
<li><a href="/view/91.html">ğŸ“‘ é¢å¤–é…ç½®</a></li>
<li><a href="/view/88.html">ğŸ“‘  æ›´æ–°æ—¥å¿—</a></li>
<li><a href="/view/72.html">ğŸ“‘ æ—¶å…‰æœºä½¿ç”¨</a></li>
<li><a href="/view/66.html">ğŸ“‘ DepyOauthæ¥å…¥æŒ‡å—</a></li>
<li><a href="/view/62.html">ğŸ“‘ å®˜æ–¹åŸŸåç”³è¯·</a></li>
<li><a href="/view/47.html">ğŸ“‘ ç§Ÿæˆ·è‡ªå®šä¹‰åŸŸåç»‘å®š</a></li>
    </ul>
 <p>åšå®¢æ–‡ç« ï¼ˆå¤‡ä»½ï¼‰</p>
    <ul>
<li><a href="/view/134.html">æŸOAæˆæƒç ´è§£åˆ†æ</a></li>
<li><a href="/view/133.html">Un1kHacking</a></li>
<li><a href="/view/132.html">Un1kLog4shellScan </a></li>
<li><a href="/view/131.html">Netty å¼€å‘Mitmè§£å†³è¯·æ±‚å“åº”åŒ¹é…é—®é¢˜	</a></li>
    </ul>
 <p>Todo</p>
    <ul>
<li><a href="/view/118.html">Todo List</a></li>
    </ul>
 <p>éšç¬”</p>
    <ul>
<li><a href="/view/128.html">å°å¹´</a></li>
<li><a href="/view/109.html">â¤ 2023</a></li>
    </ul>
 <p>æµ‹è¯•ç¬”è®°</p>
    <ul>
<li><a href="/view/129.html">ğŸ˜¡ å…³äºDDOSæˆ‘èƒ½åšä»€ä¹ˆ</a></li>
<li><a href="/view/123.html">ğŸ‘ æŸåŠ å¯†æ ·æœ¬ Traceåˆ†æ - 2</a></li>
<li><a href="/view/121.html">ğŸ‘ æŸåŠ å¯†æ ·æœ¬ Traceåˆ†æ</a></li>
<li><a href="/view/115.html">ğŸ”§ è½»é‡çº§CI/CD+æ–‡ä»¶å†…å®¹ç›‘æ§/é˜²ç¯¡æ”¹è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="/view/105.html">ğŸ¯ æœ‰ç”¨çš„å‘½ä»¤å¤‡ä»½</a></li>
<li><a href="/view/94.html">ğŸ˜Š Gateway-wokerå®ç°çƒ­é‡è½½</a></li>
<li><a href="/view/90.html">âœï¸ Xposedè¿è¡ŒåŸç†</a></li>
<li><a href="/view/89.html">AutoJS æ¨¡æ‹Ÿè´å¡å°”æ›²çº¿è§†é¢‘æ»‘åŠ¨</a></li>
<li><a href="/view/84.html">ğŸ“± å°ç±³13ç»•è¿‡SIMå¡æ‰“å¼€USBå®‰è£…</a></li>
    </ul>
 <p>è¯»ä¹¦ç¬”è®°</p>
    <ul>
<li><a href="/view/119.html">ğŸ“š æ³¨å…¥ä¸HOOK</a></li>
<li><a href="/view/117.html">ğŸ“šã€Šæ·±å…¥æ¢ç´¢å®‰å“çƒ­ä¿®å¤æŠ€æœ¯åŸç†ã€‹32 -</a></li>
<li><a href="/view/112.html">ğŸ“šã€Šæ·±å…¥æ¢ç´¢å®‰å“çƒ­ä¿®å¤æŠ€æœ¯åŸç†ã€‹1-32</a></li>
<li><a href="/view/82.html">ğŸ“šã€Šé€†å‘å·¥ç¨‹æƒå¨æŒ‡å—ã€‹ - 1-4ç« </a></li>
    </ul>
 <p>ç¼–ç¨‹å¼€å‘</p>
    <ul>
<li><a href="/view/111.html">ğŸŒ¹ Dobbyä½¿ç”¨</a></li>
<li><a href="/view/77.html">ğŸ“‘ã€å‰ç«¯å¼€å‘ã€‘lightbox+pjaxæœ€ä½³å®è·µ</a></li>
<li><a href="/view/71.html">ğŸ“‘ã€NDKå¼€å‘ã€‘NDKé‡‡é›†ã€å‹ç¼©ã€åŠ å¯†ä¼ è¾“è®¾å¤‡ä¿¡æ¯</a></li>
<li><a href="/view/70.html">ğŸ“‘ã€NDKå¼€å‘ã€‘åŸºç¡€ç¯å¢ƒæ­å»º</a></li>
    </ul>


</li>
</ul></div>
</aside><section class="content mx-auto" id="article">
        <div class="d-flex">



            <article class="markdown-section" id="main" style="word-break:break-all;">
                <div>
                <h1>Un1kHacking</h1>


                <a style="font-size:12px;color: #5f5d5d;">
                | æ—¶é—´: 2024-02-05 23:01:06| ç›®å½•:åšå®¢æ–‡ç« ï¼ˆå¤‡ä»½ï¼‰ </a>
                |
                <a style="font-size:12px;color: #007bff;" href="http://10.8.0.3:5080/tenantadmin/Tenantarticle/quickedit/quickedit.html?id=118" target="_blank">ç¼–è¾‘æœ¬æ–‡</a>
                <br>


                    <div id="content"><textarea style="display: none;">## å‰è¨€

ä¸€æ¬¾ä¸ºäº†å¿«é€Ÿæ¥å…¥äº‘å‡½æ•°ä»£ç†æµ‹è¯•çš„æ’ä»¶ã€‚æœ¬æ–‡ä¹Ÿå¯ç»™burpsuiteå¼€å‘åˆå­¦è€…æä¾›ä»0åˆ°1çš„å¼€å‘æ­¥éª¤ã€‚

## è®¾è®¡æ€è·¯

ç”±äºç›®å‰å­˜åœ¨çš„ä¸€äº›äº‘å‡½æ•°ä»£ç†å·¥å…·ä»…ä»…æ˜¯åšäº†æµé‡è½¬å‘,ä¹Ÿå°±æ˜¯è®¿é—®ç½‘ç«™çš„æ—¶å€™ä¸€è‚¡è„‘å„¿çš„æŠŠæµé‡å…¨éƒ¨é€šè¿‡ä½ çš„vpså†è½¬å‘åˆ°ä½ çš„äº‘å‡½æ•°æ¥å£å»ï¼Œä»¥è¾¾åˆ°é€šè¿‡ä½¿ç”¨äº‘å‡½æ•°çš„cdnä»£ç†æ± ä»è€Œé˜²æ­¢è¢«æ”»å‡»æº¯æºã€‚è¿™æ ·çš„æ“ä½œæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å®é™…è¿ç”¨æ˜¯å­˜åœ¨è®¸å¤šç¼ºç‚¹çš„ã€‚

é¦–å…ˆåœ¨é“¾è·¯ä¸Šï¼Œæµé‡-&gt;vps-&gt;äº‘å‡½æ•°ï¼Œéœ€è¦é€šè¿‡ä¸¤å±‚ä¸­è½¬ï¼Œç¬¬äºŒæ˜¯äº‘å‡½æ•°æˆ–è€…æ˜¯vpsçš„æ€§èƒ½ã€å¸¦å®½ä¸è¶³ï¼Œå¯¼è‡´è®¿é—®ç™¾åº¦è¿™ç§é€Ÿåº¦è¾ƒå¿«çš„ç½‘ç«™éƒ½ä¼šåŠ è½½å…¨éƒ¨èµ„æºå¯¼è‡´å¡æ­»ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç®€åŒ–ä¸€ä¸‹ï¼ŒæŠ½å–å…¶ä¸­çš„éƒ¨åˆ†åŠŸèƒ½ç»™repeaterç”¨å³å¯ã€‚

## ç¼–å†™ä»£ç 

1.é˜…è¯»å®˜æ–¹SDKä¸æ–‡æ¡£

2.äº†è§£éœ€æ±‚

éœ€è¦åœ¨repeateræ¨¡å—ï¼Œå‘é€httpè¯·æ±‚çš„æ—¶å€™ï¼Œä½¿ç”¨æ’ä»¶å‘é€æµé‡ç»™äº‘å‡½æ•°æ¥å£å¤„ç†ï¼Œæœ€åè¿”å›ä¿¡æ¯åˆ°responseå³å¯ã€‚è€Œåˆ¤æ–­åœ¨å“ªä¸ªæ¨¡å—ï¼Œburpsuite apiç»™äº†é€šç”¨æ–¹æ³•ï¼Œå¹¶ä¸”æ¨¡å—å¯ä»¥æ ¹æ®toolflagæ¥åˆ¤å®šä½¿ç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€ä¸ªç›‘å¬httpè¯·æ±‚çš„æ¨¡å—ã€‚

ä¹Ÿå°±æ˜¯IHttpListenerï¼Œä½¿ç”¨è¯¥æ¥å£å‰ï¼Œéœ€è¦å…ˆé€šè¿‡ IBurpExtenderCallbacks.registerHttpListener() æ³¨å†Œä¸€ä¸ª HTTP ç›‘å¬å™¨ï¼Œè¿™æ ·æ‰€æœ‰çš„HTTPè¯·æ±‚å’Œå“åº”éƒ½ä¼šé€šçŸ¥è¿™ä¸ªç›‘å¬å™¨ï¼Œå°±å¯ä»¥åœ¨è¿™ä¸ªç›‘å¬å™¨å¯¹HTTPæ•°æ®åŒ…è¿›è¡Œåˆ†ææˆ–ä¿®æ”¹äº†ã€‚

ä»£ç å¦‚ä¸‹:

![](https://img.meituan.net/imgupload/09142d683795358326fdeeafc6da4c08164656.png)

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æœ€å‰é¢éœ€è¦æ¥å£ç»§æ‰¿IHttpListenerï¼š

![](https://img.meituan.net/imgupload/b25e2fa843a95b4d381449fe66efdbfd12595.png)

è¯¥æ¥å£åªæä¾›äº†ä¸€ä¸ªæ–¹æ³•,processHttpMessageã€‚è¿™ä¸ªæ–¹æ³•æ‹¥æœ‰ä¸‰ä¸ªå±æ€§ï¼š

![](https://img.meituan.net/imgupload/886ec66a4a6db0cdd50149e2d16a142523865.png)

é€šè¿‡toolflagå±æ€§,åˆ¤æ–­æ˜¯å¦ä¸ºrepeateræ¨¡å— åœ¨repeateræ‰ç”Ÿæ•ˆ,ä»£ç å°±å¯ä»¥å†™

```
 if(toolFlag == 0x00000040) {
   // To do here
}
```

è¿™æ ·ç¬¬ä¸€ä¸ªè¦æ±‚å°±è½»æ¾è§£å†³äº†,æ¥ç€å°±æ˜¯åé¢çš„æ“ä½œ,è½¬å‘æµé‡åˆ°äº‘å‡½æ•°æœåŠ¡æ¥å£,å¹¶ä¸”å–æ¶ˆåŸå§‹è¯·æ±‚ã€‚è¿™é‡Œæ˜¯å¼€å‘çš„æœ€å¤§å‘ç‚¹,è¿™ä¸ªæ–¹æ³•è‡ªå¸¦ä¸€ä¸ªæ¥å£IHttpRequestResponseã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™ä¸ªæ¥å£å»æ”¹å˜è¯·æ±‚å’Œè®¾ç½®å“åº”,ä»–çš„æ–¹æ³•å¦‚ä¸‹:

![](https://img.meituan.net/imgupload/08d3173a72366d0302f7602a528ea7051030645.png)

æ‰€ä»¥æˆ‘ä»¬ä¸€å¼€å§‹éœ€è¦ä½¿ç”¨setRequestæ–¹æ³•å»ä¿®æ”¹è¯·æ±‚,ä»£ç å¦‚ä¸‹

![](https://img.meituan.net/imgupload/1d75955c3a30e7d755f20b453363f89177920.png)

è™½ç„¶è¯·æ±‚æ˜¯è¢«ä¿®æ”¹äº†,æµ‹è¯•blog.happysec.cnåŸŸåä¸‹,ä¸ç®¡repeateræ¨¡å—çš„requestæ˜¯ä»€ä¹ˆä»£ç ,è¯·æ±‚åŒ…éƒ½æ˜¯bytesä¸­çš„è¯·æ±‚åŒ…ï¼Œæ•ˆæœæ˜¯ä¼šå‘é€ä¸€ä¸ªgetè¯·æ±‚/scf.php?body=ï¼Œä»è€Œæ— è§†ä½ çš„åŒ…ä½“ã€‚

ä½†æ˜¯æµ‹è¯•å…¶ä»–åŸŸåå°±å‡ºç°é—®é¢˜äº†,ç”±äºsetrequeståªæ˜¯ä¿®æ”¹äº†requestä¸­çš„æŠ¥æ–‡,ä½†æ˜¯è¯¥è¯·æ±‚åŒ…çš„serviceä¸­çš„hostã€portã€Protocolï¼Œè¿˜æ˜¯åŸæ¥çš„a.com,http,8081ã€‚å½“seriveä¸­çš„hostä¸è¯·æ±‚åŒ…ä¸­çš„hostä¸ä¸€è‡´çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿæ— æ³•è®¿é—®çš„æƒ…å†µã€‚æ‰€ä»¥æˆ‘æŠŠæ³¨æ„åŠ›æ”¾åœ¨äº†ï¼ŒsetHttpServiceè¿™ä¸ªæ–¹æ³•ä¸Šé¢ã€‚å¦‚æœæˆ‘ä»¬ç”¨è¿™ä¸ªæ–¹æ³•,æŠŠhostã€portã€protocolæ”¹æˆæˆ‘ä»¬çš„äº‘å‡½æ•°ç›¸å…³ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥è§£å†³æˆ‘ä»¬è¿™ä¸ªé—®é¢˜ã€‚ä½†ç”±äºHttpServiceæ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¸æ˜¯å¯¹è±¡ï¼Œéœ€è¦é€šè¿‡åšä¸€ä¸ªæ¥å£å®ç°ï¼š

```
class WSHttpService implements IHttpService
```

è®©WSHttpServiceç±»å®ç°æ¥å£IHttpServiceä¸­æ‰€æœ‰çš„æ–¹æ³•,ä¹‹åå®šä¹‰ä¸‰ä¸ªå±æ€§,å¹¶é‡è½½getHost,getPort,getProtocolæ–¹æ³•ã€‚

      private String host;
        private int port;
        private String protocol;

        WSHttpService() {
            host = &#34;blog.happysec.cn&#34;;
            protocol = &#34;https&#34;;
            port = 443;
        }

        @Override
        public String getHost() {
            return host;
        }

        @Override
        public int getPort() {
            return port;
        }

        @Override
        public String getProtocol() {
            return protocol;
        }

åœ¨ç±»å®ä¾‹åŒ–æ„é€ å‡½æ•°ä¸­,å°†ä¸‰ä¸ªå‚æ•°é»˜è®¤å®šä¹‰ä¸ºäº‘å‡½æ•°çš„æ¥å£åœ°å€ã€ç«¯å£ã€åè®®ã€‚ä¹‹åæˆ‘ä»¬å®ä¾‹åŒ–ä¸€ä¸ªç±»WSHttpServiceï¼Œå¹¶ç”¨setServiceæ–¹æ³•é‡æ–°è®¾ç½®messageInfoçš„serviceä¿¡æ¯ã€‚

ä»£ç å¦‚ä¸‹:

            WSHttpService iHttpService = new WSHttpService();
            messageInfo.setHttpService(iHttpService);
            IHttpService iHttpService2 = messageInfo.getHttpService();
            this.stdout.println(iHttpService.getHost());
            this.stdout.println(iHttpService.getPort());
            this.stdout.println(iHttpService.getProtocol());
			
é‡æ–°æ‰“åŒ…æ’ä»¶åæˆ‘ä»¬è®¿é—®ç½‘ç«™æµ‹è¯•

![](https://img.meituan.net/imgupload/57fbe29c0a713e0022f07d0f348b0e35201624.png)

å‘ç°æ— è®ºè¯·æ±‚åŒ…è®¾ç½®çš„hostä¸ºå•¥ï¼Œéƒ½èµ°çš„æ˜¯WSHttpServiceç±»ä¸‹çš„hostã€portã€Protocolã€‚

è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå…¶ä»–çš„ä¹Ÿå°±æ˜¯å†™äº‘å‡½æ•°æ¥å£ã€æ‰“åŒ…åŸå§‹è¯·æ±‚headersã€å‘é€è¯·æ±‚åŒ…è‡³äº‘å‡½æ•°æ¥å£çš„ç®€å•ä»£ç å³å¯äº†ã€‚

3.æ‰“åŒ…åŸå§‹è¯·æ±‚ä»£ç ç¼–å†™

æˆ‘ä»¬éœ€è¦æŠŠåŸå§‹httpè¯·æ±‚æŠ¥æ–‡æ‰“åŒ…å‘é€ç»™äº‘å‡½æ•°æ¥å£,é€šè¿‡
```
String body =(helpers.bytesToString(messageInfo.getRequest())); //è·å–è¯·æ±‚æ•°æ®
```
è¿™è¡Œä»£ç æˆ‘ä»¬å¯ä»¥è·å–å­—ç¬¦ä¸²ç±»å‹çš„åŸå§‹è¯·æ±‚æ•°æ®,ä¹Ÿå°±æ˜¯

![](https://img.meituan.net/imgupload/4bdded238603a17f8f306413304c831439714.png)

è¿™ä¸ªæ¡†é‡Œçš„å†…å®¹

ä¸ºäº†é˜²æ­¢ç¼–ç é”™è¯¯,æˆ‘ä»¬ä½¿ç”¨base64å¯¹stringåšç¼–ç 

                try {
                    base64encodedString = Base64.getEncoder().encodeToString(body.getBytes(&#34;utf-8&#34;));
                } catch (UnsupportedEncodingException e) {
                    e.printStackTrace();
                }
				
æ¥ç€æˆ‘ä»¬åªéœ€è¦ é‡æ–°ä¿®æ”¹åŸå§‹è¯·æ±‚å³å¯

![](https://img.meituan.net/imgupload/e12cd2b7fb52a8b902b5e56bb78dc86254197.png)

æ‰€ä»¥è¿™æ ·èƒ½å¤Ÿç†è§£äº†ï¼Œå‰é¢ä¿®æ”¹serviceçš„ç›®çš„åªæ˜¯ä¸ºäº†é˜²æ­¢hostä¸ä¸€è‡´å¯¼è‡´è¯·æ±‚æ— æ³•ä¼ é€’è€Œå·²ã€‚

ç„¶åæˆ‘ä»¬ä¿®æ”¹bodyåçš„å‚æ•°ä¸ºæˆ‘ä»¬éœ€è¦ä¼ é€’çš„base64ä»£ç å³å¯

4.äº‘å‡½æ•°ä»£ç ç¼–å†™

æ­¤æ—¶burpæ’ä»¶å·²ç»ç¼–å†™å®Œæ¯•äº†ã€‚

æ¥ä¸‹æ¥å°±æ˜¯äº‘å‡½æ•°å¯¹è¯·æ±‚åŒ…çš„å¤„ç†ã€‚å¤„ç†åŸå§‹è¯·æ±‚åŒ…æå–é‡Œé¢çš„bodyã€hostã€uriã€methodã€content-typeç­‰é‡è¦å‚æ•°ï¼Œä½¿ç”¨äº‘å‡½æ•°é‡æ–°è¯·æ±‚å³å¯ã€‚

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯,ç”±äºè¯·æ±‚å’Œå“åº”éƒ½ä¼šè¢«è¿™ä¸ªç›‘å¬å™¨æ•è·,æ‰€ä»¥æˆ‘ä»¬éœ€è¦è®¾ç½®æ¡ä»¶

![](https://img.meituan.net/imgupload/db13c8f0f8561c8041cce85420077bed10421.png)

é»˜è®¤å¯¹è·å–å“åº”ä¸åšå¤„ç†å³å¯ã€‚

æˆ‘é€šè¿‡

    String body = (helpers.bytesToString(messageInfo.getRequest())); //è·å–è¯·æ±‚æ•°æ®åŒ…
å†å°†bodyè¿›è¡Œbase64ç¼–ç ï¼Œè¿™æ ·å°±å¯ä»¥å‘åŒ…ç»™äº‘å‡½æ•°æ¥å£åŸè¯·æ±‚çš„httpæŠ¥æ–‡ã€‚åšæ¥å£çš„è¯é€‰æ‹©å¾ˆå¤šï¼Œæˆ‘è¿™é‡Œé€‰æ‹©phpä»£ç æ¥å†™ã€‚

é¦–å…ˆï¼Œå¯¹åŸè¯·æ±‚é‡æ–°å‘åŒ…ï¼Œæ‹¿çš„æ˜¯httpæŠ¥æ–‡ã€‚å°±éœ€è¦ä½¿ç”¨socketæ¥writeï¼Œå†é‡æ–°å‘åŒ…ã€‚

è¿™é‡Œçš„å‘ç‚¹ä¹Ÿå¾ˆå¤šï¼Œä¸€å¼€å§‹æˆ‘ç”¨çš„æ˜¯fsockopenè¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯åé¢é‡åˆ°è¯ä¹¦é”™è¯¯çš„é—®é¢˜ï¼Œäºæ˜¯æ”¹ç”¨stream_socket_clientï¼Œå¹¶åœ¨ä¸Šä¸‹æ–‡stream_context_createåˆ›å»ºäº†ä¸€ä¸ªsslï¼ŒæŠŠverify_peer_nameå’Œverify_peeréƒ½è®¾ç½®æˆfalseï¼Œè¿™æ ·å°±å¯ä»¥å¿½ç•¥è¯ä¹¦æ–‡ä»¶æ ¡éªŒäº†ã€‚ä½†æ˜¯å‘ç°ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ä¼šä¸Šä¼ é”™è¯¯ï¼ŒæŸäº›æ¥å£ç½‘ç«™è®¿é—®ç©ºç™½ï¼Œå¹¶ä¸”ä¸æ˜¯äº‘å‡½æ•°çš„é—®é¢˜ï¼Œæ˜¯ä»£ç çš„é—®é¢˜ã€‚

åœ¨writeçš„æ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆä¸å¯é¢„è§é”™è¯¯ï¼Œæˆ‘é€šè¿‡åå¤diffè¯·æ±‚åŒ…ä¹Ÿæ²¡æœ‰æ‰¾åˆ°é—®é¢˜ï¼Œæ¥å£æ”¶åˆ°çš„è¯·æ±‚åŒ…å’ŒåŸå§‹è¯·æ±‚åŒ…æ€ä¹ˆçœ‹éƒ½æ˜¯ä¸€ä¸ªè¯·æ±‚åŒ…,äºæ˜¯æˆ‘æ”¾å¼ƒäº†è¿™ä¸ªæ€è·¯,åªèƒ½åšæŠ¥æ–‡è§£æäº†ã€‚ç„¶åç”¨curlå»å‘åŒ…ï¼ŒanalyzeRequestç»™äº†å‡ ä¸ªå¥½ç”¨çš„æ–¹æ³•ï¼Œgeturlå’ŒgetHeadersï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å¿«é€Ÿè·å–urlå’Œå¤´éƒ¨ä¿¡æ¯ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„è¿™é‡Œçš„headersçš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ç±»ä¼¼**POST /api HTTP/1.1**çš„ä¸€è¡Œï¼Œmethodä¹Ÿå¯ä»¥ç”¨getmethodè·å–,uriåœ¨urlé‡Œ,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠheadersè¿™ä¸ªlistçš„ç¬¬ä¸€ä¸ªå…ƒç´ remove,ç„¶åéƒ½ç¼–ç base64å‘ç»™æ¥å£ã€‚

è‡³æ­¤ï¼Œheadersã€urlã€methodçš„é—®é¢˜éƒ½å¯ä»¥è§£å†³,æ¥ä¸‹æ¥å°±æ˜¯è§£å†³bodyä¸­çš„æ–‡ä»¶å†…å®¹æˆ–è€…è¯·æ±‚å‚æ•°çš„è·å–äº†ã€‚å¯¹äºanalyzeRequestï¼Œburpsuite apiæ²¡æœ‰ç»™å‡ºæ‹¿åˆ°bodyå†…å®¹çš„æ¥å£ã€‚ä½†æ˜¯ç»™äº†è·å–bodyçš„åç§»é‡getbodyoffsetã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹ä»£ç è·å¾—è¯·æ±‚bodyï¼š

```
String sendData = body.substring(reqInfo.getBodyOffset());
```

ä¹Ÿå°±æ˜¯æŠŠè¯·æ±‚åŒ…ä»åç§»é‡å¼€å§‹çš„åœ°æ–¹æˆªå–å…¨éƒ¨ï¼Œå°±æ˜¯bodyçš„å†…å®¹äº†ã€‚åé¢æ‹¿åˆ°å€¼ç„¶åç”¨curl_setoptå³å¯ï¼Œå°±ä¸å¤šå†™äº†,æ•ˆæœå¦‚ä¸‹ï¼ˆè§£å†³äº†è›‹ç–¼çš„ç¼–ç é—®é¢˜ï¼‰

![](https://img.meituan.net/imgupload/6bb75f136a1b66668cef7debdc48fb0a241970.png)

![](https://img.meituan.net/imgupload/70af487760c506f002c328ac42e49e41215767.png)

å®é™…ä½¿ç”¨è¿˜æ˜¯å­˜åœ¨å¾ˆå¤šéœ€è¦æå‡çš„åœ°æ–¹,æ¯”å¦‚äº‘å‡½æ•°æ¥å£æ˜¯ç¡¬ç¼–ç çš„,ä¸æ˜¯åŠ¨æ€å¯å˜çš„ã€‚å¯¼å…¥é…ç½®æˆ‘å€’æ˜¯æ€è€ƒè¿‡,ä½†æ˜¯å‘ç°éœ€è¦ç»˜åˆ¶uiå’Œä½¿ç”¨å¦å¤–çš„åŠ è½½å™¨,æ¯”è¾ƒéº»çƒ¦,è¿˜ä¸å¦‚åœ¨burpsuiteçš„æ–‡ä»¶å¤¹ä¸‹åšä¸€ä¸ªiniçš„é»˜è®¤è½½å…¥,ä¸å­˜åœ¨å°±æç¤ºç”¨ä»€ä¹ˆå‘½ä»¤åŠ è½½ã€‚

macæ•ˆæœå¦‚ä¸‹ï¼š


![](https://img.meituan.net/imgupload/d0049def9bce0f4ce5d362b9d35c7046170536.png)
![](https://img.meituan.net/imgupload/84741625f697f03a85b51c4fbd0ce49a673829.png)

ä¹‹åå†™ä¸€ä¸ªèœå• åšç›‘å¬ å‡è®¾æˆ‘ä¿®æ”¹äº†é…ç½®æ–‡ä»¶ä¸­çš„æ¥å£ é‚£ä¹ˆç‚¹å‡»å°±ä¼šé‡è½½

![](https://img.meituan.net/imgupload/1e5e2c60bd0681572d51c610a1bb5327512587.png)

![](https://img.meituan.net/imgupload/68514ac3537e0d3ccea810149434031d174769.png)

å¯¹æ¥å£ä»£ç ä½œä¿®æ”¹ åœ¨å“åº”å†…å®¹ä¸­åŠ å…¥ä½¿ç”¨çš„api host ä¾¿äºåŒºåˆ†

![](https://img.meituan.net/imgupload/d52e08d492154acb03bce642e33eb837475595.png)

![](https://img.meituan.net/imgupload/9f8b764c089c14ec6e725fa17f77669b231627.png)

åŸºæœ¬ä¸Šè¿™æ ·å°±å¯ä»¥æŠ•å…¥ä½¿ç”¨å•¦ï½</textarea></div>


                <script>
                   $(function () {
                        
                        editormd.markdownToHTML("content");
                    })

                </script>




                </div>

                <hr>


                <div>
                    <h5>Â© ç‰ˆæƒå£°æ˜ï¼šéæ ‡æ³¨ã€è½¬è½½ã€æƒ…å†µä¸‹æœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œç‰ˆæƒå½’&nbsp;<a href="/">Depy's docs</a>&nbsp;æ‰€æœ‰ï¼Œè½¬è½½è¯·è”ç³»åšä¸»è·å¾—æˆæƒã€‚</h5>
                </div>

            </article>



    <div class="ad d-none d-lg-block">

        <div style="margin-left: 20px;margin-bottom:15px;font-weight:bold"> ã€ç›®å½•ã€ </div>
    <div class="anchorContent" id="anchorContent"> </div>
                       </div>

            </div>
    </section>
    <button class="sidebar-toggle sidebar-toggle-button" aria-label="Menu">
        <div><span></span><span></span><span></span></div>
    </button>

</main>

<link href="https://file.depy.ink/theme/docs/css/prettify.css?v=5530" rel="stylesheet">
<script src="https://file.depy.ink/theme/docs/js/prettify.js?v=5764"></script>
<script src="https://file.depy.ink/theme/docs/js/view.js?v=4125"></script>



<script>


    
    function addWatermark({
        container = document.body, 
        width = "220px", 
        height = "160px", 
        textAlign = "center", 
        textBaseline = "middle", 
        font = "16px Microsoft Yahei", 
        fillStyle = "rgba(184, 184, 184, 0.6)", 
        content = "depy|rce.ink", 
        rotate = "45", 
        zIndex = 10000, 
    }) {
        
        const canvas = document.createElement("canvas");
        canvas.setAttribute("width", width);
        canvas.setAttribute("height", height);
        const ctx = canvas.getContext("2d");
        ctx.textAlign = textAlign;
        ctx.textBaseline = textBaseline;
        ctx.font = font;
        ctx.fillStyle = fillStyle;
        ctx.rotate((Math.PI / 180) * rotate);
        ctx.fillText(content, parseFloat(width) / 2, parseFloat(height) / 2);

        
        const base64Url = canvas.toDataURL();
        const __wm = document.querySelector('.__wm');
        const watermarkDiv = __wm || document.createElement("div");
        const styleStr = `
                    position: fixed;
                    top: -70px;
                    left: 0;
                    bottom: 0;
                    right: 0;
                    width: 100%;
                    height: 100%;
                    z-index: ${zIndex};
                    pointer-events: none;
                    background-repeat: repeat;
                    background-image: url('${base64Url}')
                `;
        watermarkDiv.setAttribute("style", styleStr);
        watermarkDiv.classList.add("__wm");
        

        if (!__wm) {
            container.style.position = 'relative';
            container.insertBefore(watermarkDiv, container.firstChild);
        }
            
            const MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
            if (MutationObserver) {
                let mo = new MutationObserver(function () {
                    const __wm = document.querySelector('.__wm');
                    
                    if ((__wm && __wm.getAttribute('style') !== styleStr) || !__wm) {
                        
                        mo.disconnect();
                        mo = null;
                        console.log('1');
                        addWatermark({
                            container: document.getElementById("watermark"),
                            width: "220px",
                            height: "160px",
                            textAlign: "center",
                            textBaseline: "middle",
                            font: "16px Microsoft Yahei",
                            fillStyle: "rgba(184, 184, 184, 0.3 )",
                            content: "depy|rce.ink",
                            rotate: "30",
                            zIndex: 10000,
                        });
                    }
                });

                mo.observe(container, {
                    attributes: true,
                    subtree: true,
                    childList: true
                });
            }
    }



    function addwm(){
    addWatermark({
        container: document.getElementById("watermark"),
        width: "220px",
        height: "160px",
        textAlign: "center",
        textBaseline: "middle",
        font: "16px Microsoft Yahei",
        fillStyle: "rgba(184, 184, 184, 0.3 )",
        content: "depy|rce.ink",
        rotate: "30",
        zIndex: 10000,
    });
}

addwm();
</script>

</body>
</html>