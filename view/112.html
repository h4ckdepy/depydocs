

<!doctype html>
<html lang="zh-cn" >
<head>
    <meta charset="utf-8">
    <link rel="icon" href="data:image/ico;base64,aWNv">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://file.depy.ink/theme/docs/css/bootstrap.min.css?v=8280" rel="stylesheet">
    <link href="https://file.depy.ink/theme/docs/css/main.css?v=3525" rel="stylesheet">
    <script src="https://file.depy.ink/theme/docs/js/jquery.min.js"></script>
    <script src="https://file.depy.ink/theme/docs/js/bootstrap.min.js?v=4094"></script>
    <script src="https://file.depy.ink/theme/docs/js/functions.js?v=8141"></script>
    <script src="https://file.depy.ink/theme/docs/js/marked.min.js"></script>
    <link href="https://file.depy.ink/theme/docs/css/doc.css?v=4299" rel="stylesheet">
    <link rel="stylesheet" href="https://file.depy.ink/assets/editor/editormd/css/editormd.css?v=6567" />
    <script src="https://file.depy.ink/assets/editor/editormd/editormd.js"></script>
    <script src="https://file.depy.ink/assets/editor/editormd/lib/marked.min.js"></script>
    <script src="https://file.depy.ink/assets/editor/editormd/lib/prettify.min.js"></script>

    <script src="https://file.depy.ink/theme/docs/js/pjax.min.js"></script>
    <!--<script type="text/javascript" src="/assets/jquery.pjax.min.js"></script>-->
    
    
    <script src="https://file.depy.ink/theme/docs/js/lightbox-plus-jquery.min.js"> </script>
    <link href="https://file.depy.ink/theme/docs/css/lightbox.css?v=3328" rel="stylesheet"><title>ğŸ“šã€Šæ·±å…¥æ¢ç´¢å®‰å“çƒ­ä¿®å¤æŠ€æœ¯åŸç†ã€‹1-32 - Depy's docs</title><li><a href="/view/112.html">ğŸ“šã€Šæ·±å…¥æ¢ç´¢å®‰å“çƒ­ä¿®å¤æŠ€æœ¯åŸç†ã€‹1-32</a></li>
</head>

<body class="bg-light ready sticky" id="watermark">


             <nav class="navbar navbar-expand-lg navbar-light shadow-sm bg-white mybt2 sticky-top">
        <div class="container-fluid" style="max-width:1332px;">
            <a class="navbar-brand" href="/"><b class="">Depy's docs</b></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="/" >é¦–é¡µ</a>
                    </li>

                </ul>

            </div>
        </div>
    </nav>
                     

<main>


<aside class="sidebar">
           <div class="sidebar-nav mt-2">
            <ul>

                

                


<li> <p>ç¼–ç¨‹å¼€å‘</p>
    <ul>
<li><a href="/view/111.html">ğŸŒ¹ Dobbyä½¿ç”¨</a></li>
<li><a href="/view/77.html">ğŸ“‘ã€å‰ç«¯å¼€å‘ã€‘lightbox+pjaxæœ€ä½³å®è·µ</a></li>
<li><a href="/view/71.html">ğŸ“‘ã€NDKå¼€å‘ã€‘NDKé‡‡é›†ã€å‹ç¼©ã€åŠ å¯†ä¼ è¾“è®¾å¤‡ä¿¡æ¯</a></li>
<li><a href="/view/70.html">ğŸ“‘ã€NDKå¼€å‘ã€‘åŸºç¡€ç¯å¢ƒæ­å»º</a></li>
    </ul>
 <p>é€†å‘åˆ†æ</p>
    <ul>
<li><a href="/view/86.html">âš™ï¸ ã€Xposed æ”¹æœºã€‘- åŸºç¡€ç¯å¢ƒå®‰è£…</a></li>
<li><a href="/view/81.html">ğŸ’» å®‰å“å†…è”æ±‡ç¼–å¼€å‘</a></li>
<li><a href="/view/76.html">ğŸ“‘ JNI ä½¿ç”¨åŸºç¡€</a></li>
<li><a href="/view/75.html">ğŸ“‘ IDA Debugger è°ƒè¯•å™¨ä½¿ç”¨</a></li>
<li><a href="/view/74.html">ğŸ’» std::stringå†…å­˜å¸ƒå±€</a></li>
<li><a href="/view/73.html">ğŸ’¼ Fridaä½œä¸š-20231114</a></li>
<li><a href="/view/65.html">ğŸ§® JSVMPæ‰§è¡Œæµç¨‹åˆ†æ</a></li>
    </ul>
 <p>DepyDocs</p>
    <ul>
<li><a href="/view/122.html">ğŸ“‘ DepyDocs</a></li>
<li><a href="/view/120.html">ğŸ“‘  Un1kMsgä½¿ç”¨</a></li>
<li><a href="/view/114.html">ğŸ“‘ è”ç³»æ–¹å¼</a></li>
<li><a href="/view/91.html">ğŸ“‘ é¢å¤–é…ç½®</a></li>
<li><a href="/view/88.html">ğŸ“‘  æ›´æ–°æ—¥å¿—</a></li>
<li><a href="/view/72.html">ğŸ“‘ æ—¶å…‰æœºä½¿ç”¨</a></li>
<li><a href="/view/66.html">ğŸ“‘ DepyOauthæ¥å…¥æŒ‡å—</a></li>
<li><a href="/view/62.html">ğŸ“‘ å®˜æ–¹åŸŸåç”³è¯·</a></li>
<li><a href="/view/47.html">ğŸ“‘ ç§Ÿæˆ·è‡ªå®šä¹‰åŸŸåç»‘å®š</a></li>
    </ul>
 <p>Todo</p>
    <ul>
<li><a href="/view/118.html">Todo List</a></li>
    </ul>
 <p>éšç¬”</p>
    <ul>
<li><a href="/view/128.html">å°å¹´</a></li>
<li><a href="/view/109.html">â¤ 2023</a></li>
    </ul>
 <p>æµ‹è¯•ç¬”è®°</p>
    <ul>
<li><a href="/view/129.html">å…³äºDDOSæˆ‘èƒ½åšä»€ä¹ˆ</a></li>
<li><a href="/view/123.html">ğŸ‘ æŸåŠ å¯†æ ·æœ¬ Traceåˆ†æ - 2</a></li>
<li><a href="/view/121.html">ğŸ‘ æŸåŠ å¯†æ ·æœ¬ Traceåˆ†æ</a></li>
<li><a href="/view/115.html">ğŸ”§ è½»é‡çº§CI/CD+æ–‡ä»¶å†…å®¹ç›‘æ§/é˜²ç¯¡æ”¹è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="/view/105.html">ğŸ¯ æœ‰ç”¨çš„å‘½ä»¤å¤‡ä»½</a></li>
<li><a href="/view/94.html">ğŸ˜Š Gateway-wokerå®ç°çƒ­é‡è½½</a></li>
<li><a href="/view/90.html">âœï¸ Xposedè¿è¡ŒåŸç†</a></li>
<li><a href="/view/89.html">AutoJS æ¨¡æ‹Ÿè´å¡å°”æ›²çº¿è§†é¢‘æ»‘åŠ¨</a></li>
<li><a href="/view/84.html">ğŸ“± å°ç±³13ç»•è¿‡SIMå¡æ‰“å¼€USBå®‰è£…</a></li>
    </ul>
 <p>è¯»ä¹¦ç¬”è®°</p>
    <ul>
<li><a href="/view/119.html">ğŸ“š æ³¨å…¥ä¸HOOK</a></li>
<li><a href="/view/117.html">ğŸ“šã€Šæ·±å…¥æ¢ç´¢å®‰å“çƒ­ä¿®å¤æŠ€æœ¯åŸç†ã€‹32 -</a></li>
<li><a href="/view/112.html">ğŸ“šã€Šæ·±å…¥æ¢ç´¢å®‰å“çƒ­ä¿®å¤æŠ€æœ¯åŸç†ã€‹1-32</a></li>
<li><a href="/view/82.html">ğŸ“šã€Šé€†å‘å·¥ç¨‹æƒå¨æŒ‡å—ã€‹ - 1-4ç« </a></li>
    </ul>
</li>
</ul></div>
</aside><section class="content mx-auto" id="article">
        <div class="d-flex"> 


           
            <article class="markdown-section" id="main" style="word-break:break-all;">
                
                <div>
                <h1>ğŸ“šã€Šæ·±å…¥æ¢ç´¢å®‰å“çƒ­ä¿®å¤æŠ€æœ¯åŸç†ã€‹1-32</h1>

                
                <a style="font-size:12px;color: #5f5d5d;">å¯†çº§: 
                
                                ã€<span style="color:green">C-1</span>ã€‘
                                 
                
                | æ—¶é—´: | ç›®å½•:è¯»ä¹¦ç¬”è®° </a> 
                
                | 
                <a style="font-size:12px;color: #007bff;" href="http://10.8.0.4:5080/tenantadmin/Tenantarticle/quickedit/quickedit.html?id=118" target="_blank">ç¼–è¾‘æœ¬æ–‡</a>
                <br>             
                                

                    <div id="content"><textarea style="display: none;">## æŠ€æœ¯ä»‹ç»

ä¼ ç»Ÿæµç¨‹æŠ€æœ¯å¼Šç«¯ï¼š

1ã€é‡æ–°å‘å¸ƒç‰ˆæœ¬ä»£ä»·å¤ªå¤§
2ã€ç”¨æˆ·ä¸‹è½½å®‰è£…æˆæœ¬å¤ªé«˜
3ã€Bugä¸ä¿®å¤ç”¨æˆ·ä½“éªŒå·®

hybirdæ–¹æ¡ˆï¼Œå°†å¸¸ç”¨ä¸šåŠ¡é€»è¾‘ä»¥h5çš„æ–¹å¼å±•ç¤ºå‡ºæ¥ï¼Œä½†éœ€è¦å¼€å‘è€…é¢å¤–æŒæ¡å‰ç«¯è¯­è¨€ç­‰æŠ€æœ¯æ ˆã€‚å¯¹äºæ— æ³•è½¬æ¢æˆh5çš„ä¸šåŠ¡é€»è¾‘ä¹Ÿæ— æ³•åšåˆ°ä¿®æ”¹ã€‚

çƒ­ä¿®å¤æŠ€æœ¯åº”è¿è€Œç”Ÿï¼Œé€šè¿‡äº‘ç«¯æ¨é€è¡¥ä¸ï¼Œè¿›è¡Œè‡ªåŠ¨æ‹‰å–ä¸è¡¥ä¸ä¿®å¤ã€‚

![](https://img.meituan.net/imgupload/6ceab5cfabe99836af860a9076275736186860.png)

### åº•å±‚ä¿®å¤æ–¹æ¡ˆ

åœ¨å·²ç»åŠ è½½çš„ç±»ä¸­æ›¿æ¢åŸæœ‰çš„æ–¹æ³•ï¼Œä½†æ˜¯æ— æ³•å®ç°æ–¹æ³•çš„å¢åŠ ä¸å­—æ®µçš„å¢åŠ ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ— æ³•ç´¢å¼•åˆ°æ­£ç¡®çš„ç±»ã€‚å¹¶ä¸”å®ä¾‹åŒ–çš„å¯¹è±¡ä¼šå‡ºç°éé¢„æœŸçš„æ•ˆæœã€‚

ä¾èµ–ä¿®æ”¹è™šæ‹Ÿæœºæ–¹æ³•å®ç°çš„å…·ä½“å­—æ®µï¼Œä¾‹å¦‚ä¿®æ”¹Dalvikæ–¹æ³•çš„jniå‡½æ•°æŒ‡é’ˆï¼Œæ”¹ç±»ä¸æ–¹æ³•çš„è®¿é—®æƒé™ç­‰ã€‚å®‰å“æ˜¯å¼€æºçš„ï¼Œå„å¤§æ‰‹æœºå‚å•†å¯ä»¥å¯¹æºç è¿›è¡Œæ”¹é€ ï¼Œå¦‚æœå†™æ­»äº†ArtMethodæ–¹æ³•çš„ç»“æ„ï¼Œä½†æ˜¯é€‚é…åˆ°äº†é­”æ”¹çš„æ‰‹æœºï¼Œä¼šå‡ºç°éé¢„æœŸçš„åæœã€‚


### ç±»åŠ è½½æ–¹æ¡ˆ

åœ¨appé‡æ–°å¯åŠ¨åï¼Œè®©classloaderåŠ è½½æ–°çš„ç±»ã€‚å®‰å“æ— æ³•å¯¹å·²åŠ è½½çš„ç±»è¿›è¡Œå¸è½½ï¼Œä¸é‡å¯ï¼ŒåŸå…ˆçš„ç±»è¿˜åœ¨è™šæ‹Ÿæœºä¸­ï¼Œä¹Ÿæ— æ³•åŠ è½½æ–°çš„ç±»ã€‚åªæœ‰åœ¨é‡å¯åï¼Œåœ¨åŠ è½½æ—§ç±»ä¹‹å‰æŠ¢å…ˆåŠ è½½ï¼Œè¿™æ ·åç»­è®¿é—®è¿™ä¸ªæ—§ç±»çš„æ—¶å€™æ‰ä¼šresolveæˆæ–°çš„ç±»ã€‚

### åˆå¹¶æ–¹æ¡ˆ

æ ¹æ®æƒ…å†µé€‰æ‹©ä¿®å¤æ–¹æ³•ï¼Œè¡¥ä¸ç”Ÿæˆæ—¶åˆ¤æ–­ä½¿ç”¨åº•å±‚ä¿®å¤è¿˜æ˜¯ç±»åŠ è½½æ–¹æ¡ˆä¿®å¤ã€‚

### èµ„æºä¿®å¤

#### Install Run å®ç°åŸç†

1ã€æ„é€ æ–°çš„AssetManagerï¼Œåå°„è°ƒç”¨addAssertPathã€‚è·å–ä¸€ä¸ªåŒ…å«æ–°èµ„æºçš„AssetManager
2ã€é€šè¿‡åå°„æŠŠæ‰€æœ‰å¼•å…¥æ—§çš„AssetManagerä¿®æ”¹ä¸ºæ–°çš„AssetManager

ä»£ç å¤„ç†é€»è¾‘åŸºæœ¬é›†ä¸­äºå¦‚ä½•æ‰¾åˆ°æ‰€æœ‰å¼•ç”¨AssetManagerçš„ä»£ç ä½ç½®ã€‚

#### Sophix å®ç°

1ã€æ„é€ æ–°çš„èµ„æºåŒ…ï¼ŒåªåŒ…å«æ–°èµ„æºä¸ä¿®å¤çš„èµ„æº
2ã€åœ¨AssetManagerå¯¹è±¡åšææ„ä¸é‡æ„ï¼Œè¿™æ ·åŸæ¥çš„æ‰€æœ‰å¼•ç”¨æ˜¯ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„ã€‚

è¿™æ ·æ— éœ€ä¸‹å‘å®Œæ•´åŒ…ï¼Œæ— éœ€åˆæˆå®Œæ•´åŒ…ï¼Œæ›¿æ¢æ›´å¿«æ›´å®Œå…¨ã€‚

### soå±‚ä¿®å¤

soåº“ä¿®å¤æœ¬è´¨æ˜¯å¯¹nativeæ–¹æ³•çš„ä¿®å¤å’Œæ›¿æ¢ã€‚

æŠŠè¡¥ä¸soåº“çš„è·¯å¾„æ’å…¥åˆ°native-libraryDirectoriesæ•°ç»„çš„æœ€å‰é¢ã€‚å°±èƒ½è¾¾åˆ°åŠ è½½soåº“çš„æ—¶å€™æ˜¯è¡¥ä¸soåº“ï¼Œè€Œä¸æ˜¯åŠ è½½åŸæ¥çš„soåº“ã€‚åœ¨å¯åŠ¨æœŸé—´åå°„æ³¨å…¥patchä¸­çš„soåº“ï¼Œå¯¹å¼€å‘è€…æ˜¯é€æ˜çš„ã€‚å…¶ä»–æ–¹æ¡ˆå¯èƒ½éœ€è¦æ‰‹åŠ¨ä¿®æ”¹system.loadå‡½æ•°ä»¥å®ç°æ›¿æ¢ç›®çš„ã€‚

## æŠ€æœ¯åŸç†

### Andfixåº•å±‚æ›¿æ¢æ–¹æ¡ˆåŸç†

åœ¨nativeå±‚ä¸­ç›´æ¥æ›¿æ¢æ‰åŸæœ‰æ–¹æ³•ã€‚åœ¨åŸæœ‰ç±»åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚å…·ä½“å®ç°ï¼š

![](https://img.meituan.net/imgupload/ee55d32083aee39723b52725865b8d8825108.png)

å‚æ•°ä¸€æ˜¯éœ€è¦ä¿®æ”¹çš„æ–¹æ³•ï¼Œå‚æ•°äºŒæ˜¯éœ€è¦æ›¿æ¢çš„æ–¹æ³•ã€‚æ–°æ–¹æ³•å­˜åœ¨äºè¡¥ä¸åŒ…ä¸­ã€‚

![](https://img.meituan.net/imgupload/aaaa4ca856c87e26d69aa0ed10191ead43120.png)

é€šè¿‡å®‰å“è™šæ‹Ÿæœºç±»å‹åˆ¤æ–­ï¼Œåˆ‡æ¢ä¸åŒåˆ†æ”¯ã€‚ä»¥artè™šæ‹Ÿæœºä¸ºä¾‹ï¼Œä¸åŒå®‰å“ç‰ˆæœ¬çš„artï¼Œåº•å±‚javaå¯¹è±¡çš„æ•°æ®ç»“æ„æ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥ä¼šæ ¹æ®ä¸åŒçš„å®‰å“ç‰ˆæœ¬è¿›å…¥ä¸åŒçš„åˆ†æ”¯ï¼Œä»¥å®‰å“6.0ä¸ºä¾‹ï¼š

![](https://img.meituan.net/imgupload/2606a670317728914e85ac667e94342f44012.png)
![](https://img.meituan.net/imgupload/9f54022fca37ba8132e4cd63fee3dae5216719.png)

é€šè¿‡env->FromReflectMethod,å¯ä»¥ç”±methodå¯¹è±¡è·å–åˆ°è¿™ä¸ªæ–¹æ³•å¯¹åº”çš„ArtMethodçš„çœŸæ­£èµ·å§‹åœ°å€ï¼Œç„¶åæŠŠå®ƒå¼ºè½¬ä¸ºæŒ‡é’ˆï¼Œç„¶åå°±å¯ä»¥å¯¹æ‰€æœ‰æˆå‘˜è¿›è¡Œä¿®æ”¹ã€‚

é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œå®ç°å¯¹ç›®æ ‡å‡½æ•°åˆ°è¡¥ä¸å‡½æ•°çš„æ›¿æ¢ã€‚

### ä¸ºä½•å¯ä»¥å®ç°çƒ­ä¿®å¤ï¼Ÿ

å®‰å“6.0ï¼Œè™šæ‹Ÿæœºè°ƒç”¨æ–¹æ³•åŸç†ã€‚

artmethodç»“æ„æœ€é‡è¦çš„ä¸¤ä¸ªå­—æ®µæ˜¯entry_point_from_interceptå’Œentry_point_from_quick_compiled_codeï¼Œä»–ä»¬æ˜¯æ–¹æ³•çš„æ‰§è¡Œå…¥å£ã€‚javaä»£ç ä¼šåœ¨å®‰å“è™šæ‹Ÿæœºä¸­ç¼–è¯‘æˆDex codeã€‚artä¸­é‡‡ç”¨è§£é‡Šæ¨¡å¼æˆ–è€…AOTæœºå™¨ç æ¨¡å¼æ‰§è¡Œã€‚

è§£é‡Šæ¨¡å¼æ˜¯æå–dex codeï¼Œé€æ¡è§£é‡Šæ‰§è¡Œå³å¯ã€‚è§£é‡Šæ¨¡å¼ä¸‹ä¼šå–å¾—è¿™ä¸ªæ–¹æ³•çš„entry_point_from_interceptï¼Œç„¶åè·³è½¬è¿‡å»æ‰§è¡Œã€‚

aotæ¨¡å¼ä¼šé¢„ç¼–è¯‘dex codeå¯¹åº”çš„æœºå™¨ç ï¼Œç„¶åè¿è¡ŒæœŸé—´ä¸€æ¡æ¡æ‰§è¡Œæœºå™¨ç å³å¯ã€‚åŒæ ·çš„ï¼Œä»–ä¼šè·³è½¬åˆ°entry_point_from_quick_compiled_codeåœ°å€ã€‚

æ‰€ä»¥ä¼šæƒ³åˆ°æ›¿æ¢è¿™ä¸¤ä¸ªå…¥å£åœ°å€å³å¯å®ç°æ–¹æ³•çš„æ›¿æ¢ã€‚ä½†å®é™…ä¸Šï¼Œç”¨åˆ°äº†ç»“æ„ä¸­çš„å…¶ä»–æˆå‘˜å­—æ®µã€‚

![](https://img.meituan.net/imgupload/87e3cd947ff23b170b26f363d798ea8330605.png)

ä¸Šå›¾ä¸­çš„ä»£ç ï¼Œç¼–è¯‘æˆaotæœºå™¨ç ï¼Œå¦‚ä¸‹ï¼š

![](https://img.meituan.net/imgupload/6dde183ab060367ac019469ac3c60288168907.png)

åœ¨è°ƒç”¨æ–¹æ³•æ—¶ï¼Œå–å¾—äº†ç»“æ„ä¸­çš„dex_cache_resolved_methods_å­—æ®µã€‚è¿™æ˜¯ä¸€ä¸ªå­˜æ”¾äº†ArtMethod* çš„æŒ‡é’ˆæ•°ç»„ã€‚

é€šè¿‡å®ƒå¯ä»¥è®¿é—®åˆ°è¿™ä¸ªmethodæ‰€åœ¨dexçš„æ‰€æœ‰methodå¯¹åº”çš„artmethod*ã€‚Activity.oncreateæ–¹æ³•çš„ç´¢å¼•æ˜¯70ï¼Œ64ä½ç³»ç»Ÿæ¯ä¸ªæŒ‡é’ˆå¤§å°æ˜¯8å­—èŠ‚ã€‚artmethod*å…ƒç´ æ˜¯ä»è¿™ä¸ªæ•°ç»„çš„0x2ä¸ªä½ç½®å¼€å§‹å­˜æ”¾çš„ï¼Œå› æ­¤åç§»æ˜¯ï¼ˆ70+2ï¼‰*8ã€‚å…¶ä»–ä¾‹å­ä¸­è¿˜ä¼šç”¨åˆ°å…¶ä»–æˆå‘˜å±æ€§ï¼Œæ‰€ä»¥éœ€è¦æŠŠæ‰€æœ‰çš„æˆå‘˜å­—æ®µéƒ½åšæ›¿æ¢æ‰èƒ½åšåˆ°é¡ºæ»‘çš„çƒ­ä¿®å¤ã€‚

### å…¼å®¹ç¼ºé™·

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ã€‚andfixæŠŠåº•å±‚ç»“æ„å¼ºè½¬äº†art::method::ArtMethodï¼Œè¿™æ˜¯andfixè‡ªå·±å®šä¹‰çš„ç±»ï¼Œä¸aospæºç ä¸€è‡´ã€‚ä½†æ˜¯å¹¶ä¸ä»£è¡¨æ˜¯è¿è¡Œæ—¶æœºå‹çš„artmethodï¼Œå¦‚æœè¿è¡Œæœºå™¨åœ¨ç¬¬ä¸€ä¸ªæˆå‘˜å±æ€§å‰åŠ äº†å±æ€§ï¼Œé‚£ä¹ˆå¼ºè½¬å°±ä¼šå‡ºç°é”™è¯¯ã€‚å¯¼è‡´éœ€è¦æ›¿æ¢çš„æˆå‘˜æ²¡æœ‰åšåˆ°åº”è¯¥çš„æ›¿æ¢ã€‚

è¿™ä¹Ÿæ˜¯andfixæ— æ³•é€‚é…å¾ˆå¤šæœºå‹çš„åŸå› ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æ‰‹æœºå‚å•†å¯¹romçš„artmethodåšäº†é­”æ”¹ã€‚

## çªç ´åº•å±‚ç»“æ„å·®å¼‚

å°†æˆå‘˜å±æ€§æ›¿æ¢ç¼–ç¨‹artmethodæ•´ä½“æ›¿æ¢ã€‚

![](https://img.meituan.net/imgupload/fe84ab4634e0b38d77780df244861cb190533.png)

å˜æˆ

![](https://img.meituan.net/imgupload/e05643a8dc25417f9683699480abb9109068.png)


è¿™æ ·å³ä¾¿ä»»æ„å‚å•†æŠŠåº•å±‚ç»“æ„æ”¹çš„å…­äº²ä¸è®¤ï¼Œä¹Ÿå¯ä»¥åšåˆ°æŠŠæ—§æ–¹æ³•æˆå‘˜å˜æˆæ–°æ–¹æ³•æˆå‘˜ã€‚ä½†æ˜¯å…³é”®çš„åœ°æ–¹åœ¨äºï¼Œå¦‚ä½•è®¡ç®—sizeof(ArtMethod)ã€‚sizeè®¡ç®—æœ‰åå·®ï¼Œæˆ–è€…æ›¿æ¢åŒºåŸŸè¶…å‡ºè¾¹ç•Œï¼Œä¼šå‡ºç°éå¸¸ä¸¥é‡çš„åæœã€‚

romå¼€å‘è€…æ¥è¯´éå¸¸ç®€å•ï¼Œä½†æ˜¯ä¸Šå±‚å¼€å‘è€…æ˜¯éœ€è¦åœ¨è¿è¡Œæ—¶è·å–ArtMethodçš„å¤§å°çš„ã€‚æ‰€ä»¥éœ€è¦ä»è™šæ‹Ÿæœºçš„æºç å…¥æ‰‹ï¼Œä»åº•å±‚çš„æ•°æ®ç»“æ„ä»¥åŠæ’åˆ—ç‰¹ç‚¹æ¢å¯»ç­”æ¡ˆï¼š

![](https://img.meituan.net/imgupload/e93caea5ad1e72429b5d3938659eb4c996515.png)

artä¸­ï¼Œåˆå§‹åŒ–ä¸€ä¸ªç±»ä¼šç»™ç±»çš„æ‰€æœ‰æ–¹æ³•åˆ†é…ç©ºé—´ã€‚æœ‰directæ–¹æ³•å’Œvirtualæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ç±»çš„staticä¸ä¸å¯è¢«ç»§æ‰¿çš„å¯¹è±¡æ–¹æ³•ã€‚virtualä¸­å°±æ˜¯æ‰€æœ‰çš„å¯ä»¥è¢«ç»§æ‰¿çš„æ–¹æ³•äº†ã€‚ AllocArtMethodArrayå‡½æ•°åˆ†é…äº†ä»–ä»¬çš„æ–¹æ³•æ‰€åœ¨åŒºåŸŸã€‚

![](https://img.meituan.net/imgupload/25f39a8afb0d3ac2bf62d64c1f5258c492441.png)

ptræ˜¯æ–¹æ³•æ•°ç»„çš„æŒ‡é’ˆï¼Œæ–¹æ³•æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªç´§å¯†çš„newå‡ºæ¥çš„ã€‚è¿™æ—¶åªæ˜¯åˆ†é…ç©ºé—´ï¼Œå¹¶æ²¡æœ‰å¡«å…¥å„ä¸ªArtMethodçš„æˆå‘˜å€¼ã€‚

![](https://img.meituan.net/imgupload/af7dc5ef7ecf2377e081e3b8060c902532930.png)

å¯ä»¥å‘ç°ArtMethodæ˜¯ç´§å¯†æ’åˆ—çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªArtMethodçš„å¤§å°ä¸å°±æ˜¯ç›¸é‚»ä¸¤ä¸ªæ–¹æ³•å¯¹åº”çš„ArtMethodçš„èµ·å§‹åœ°å€å·®å€¼å—ï¼Ÿ

![](https://img.meituan.net/imgupload/81462e9f420905d7f586cc9d6b5d1b4d40141.png)

å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨jniå±‚è·å–åˆ°ä»–ä»¬çš„å€¼ã€‚é—®é¢˜ å°±è¿åˆƒè€Œè§£äº†ã€‚

## è®¿é—®æƒé™

è¡¥ä¸ä¸­çš„ç±»è®¿é—®åŒåŒ…åä¸‹çš„ç±»ä¼šå‡ºç°è®¿é—®æƒé™å¼‚å¸¸ã€‚å› ä¸ºä¸åŸæ¥çš„ç±»ä¸æ˜¯ä¸€ä¸ªclassloaderï¼Œå› æ­¤ä¸¤ä¸ªç±»ä¸ä¼šåˆ¤å®šä¸ºåŒåŒ…åã€‚

![](https://img.meituan.net/imgupload/0336125f0b9e46b8ef56489dcbf543c422127.png)

è™šæ‹Ÿæœºçš„ä»£ç ä¸­ä¹Ÿè¦æ±‚classloaderå¿…é¡»ä¸€è‡´ã€‚æ‰€ä»¥éœ€è¦åå°„ä¿®æ”¹æ–°ç±»çš„classloaderä¸ºåŸæ¥çš„classloaderã€‚

![](https://img.meituan.net/imgupload/89fa2268cbadb66440e6b0f4fc92b75536455.png)

### åå°„è°ƒç”¨éé™æ€æ–¹æ³•äº§ç”Ÿçš„é—®é¢˜

![](https://img.meituan.net/imgupload/2b9e9d04d5202857ad689962a251a7dc33854.png)

![](https://img.meituan.net/imgupload/455c98f8cc636774a70efdacc802284e27765.png)

åå°„è°ƒç”¨åï¼Œè™½ç„¶gotçš„ç±»åä¸€è‡´ã€‚ä½†æ˜¯ç¡®æ˜¯ä¸åŒçš„ç±»ã€‚å‰è€…æ˜¯è¢«çƒ­æ›¿æ¢çš„ç±»ï¼Œåè€…æ˜¯åŸæœ‰çš„ç±»ã€‚ä¸¤è€…æ˜¯ä¸åŒçš„ã€‚åœ¨åº•å±‚ä¼šè°ƒç”¨åˆ°invokemethodï¼š

![](https://img.meituan.net/imgupload/baae3658a292f73772dfb9121bb499a851023.png)

è¿™é‡Œä¼šåšéªŒè¯ï¼Œoä»£è¡¨ä½œç”¨çš„å¯¹è±¡ã€‚cä»£è¡¨ArtMethodæ‰€å±çš„classã€‚æ‰€ä»¥oå¿…é¡»æ˜¯cçš„å®ä¾‹æ‰èƒ½é€šè¿‡éªŒè¯ï¼Œæ‰€ä»¥å¿…ç„¶ä¸ä¼šé€šè¿‡éªŒè¯ã€‚

é™æ€æ–¹æ³•æ˜¯åœ¨ç±»çš„çº§åˆ«ç›´æ¥è°ƒç”¨çš„ï¼Œä¸éœ€è¦æ¥å—å¯¹è±¡ä½œä¸ºå…¥å‚ã€‚æ‰€ä»¥æ— éœ€æ£€æŸ¥ã€‚å¯¹äºè¿™ç§é—®é¢˜ï¼Œåç»­ä¼šä½¿ç”¨å†·å¯åŠ¨çš„æ–¹æ³•æ¥å¤„ç†ã€‚

## å³æ—¶ç”Ÿæ•ˆé™åˆ¶

æ— æ³•æ·»åŠ å‡å°‘å­˜åœ¨çš„ç±»çš„å­—æ®µã€æ–¹æ³•ï¼Œåªèƒ½åšåˆ°å†…å®¹æ›´æ¢ã€‚ä¸¤ç§æƒ…å†µä¸é€‚ç”¨ï¼š

1ã€å¼•èµ·åŸæœ‰ç±»ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ›´æ”¹
2ã€ä¿®å¤äº†çš„éé™æ€æ–¹æ³•ä¼šè¢«åå°„è°ƒç”¨

å¯¹äºå…¶ä»–æƒ…å†µï¼Œè¿™ç§æ–¹å¼çš„çƒ­ä¿®å¤éƒ½å¯ä»¥è¢«ä»»æ„ä½¿ç”¨ã€‚

</textarea></div>
                <script>
                   $(function () {
                        //é€šè¿‡editor.mdæ¸²æŸ“å†…å®¹
                        editormd.markdownToHTML("content");
                    })
                    
                </script>


                                

                </div>

                <hr>
                è¯„è®ºåˆ—è¡¨
                <!-- è¯„è®ºåˆ—è¡¨ -->
                <div id="comment-list" class="">

                    
                    
                    

                </div>


                <div class="mt-3 d-flex align-items-center justify-content-end">
                    <!-- <span class="mr-2 f14 text-secondary mt-2">ç¼–è¾‘äº2021-12-07 15:51:46</span> -->
                    <a type="button" id="toggleButton" style="color:#fff" rel="nofollow" class="btn btn-primary btn-sm mt-2">
                        å†™è¯„è®º
                    </a>
                </div>

                <!-- è¾“å…¥è¯„è®º -->
                <div class="replies mt-4" style="display: none;" id="replies">
                    <div class="card">
                        <div class="card-body py-0 px-3">
                            <ul class="list-group list-group-flush reply-list">
                                <li class="list-group-item text-center px-0 my4 text-secondary no-reply">
                                    <small>æ‚¨çš„IP:,ä¸´æ—¶ç”¨æˆ·å:18c428cb<br>è¯„è®ºå·²æ¥å…¥DepyWAFå®¡è®¡ä¸æµé‡ç³»ç»Ÿ,è¯·å‹¿é¢‘ç¹æ“ä½œå¯¼è‡´IPæ‹‰é»‘</small>
                                </li>
                                                                                </ul>
                        </div>

                                                                    <div class="card-body p-3 border-top">
                            <div>
                                <textarea autoheight="true" id="comment" class="form-control form-control-sm reply-textarea" rows="1" placeholder="æ’°å†™è¯„è®º ..." name="text"></textarea>
                            </div>
                            <div class="mt-y d-flex align-content-center justify-content-end">
                                <input id="verify" class="form-control mt-3 mx-4" style="width: 100px" type="search" name="verify" placeholder="code" value="" autocomplete="off">
                                <div style="margin-top:20px" id="verifypic"><img width="10%" src="data:image/png;base64,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"></div>
                            </div>
                            <a id="key" data="65bdfe43b60f2"></a>
                            <a id="view_id" data="118"></a>
                            <div class="mt-y d-flex align-content-center justify-content-end">
                                <button type="button" id="submitComment" submit-type="reply" class="btn btn-primary btn-sm mt-3">
                                    æäº¤è¯„è®º
                                </button>
                            </div>
                        </div>
                        
                    </div>
                </div>

                <hr><div>



                    <h5>Â© ç‰ˆæƒå£°æ˜ï¼šéæ ‡æ³¨ã€è½¬è½½ã€æƒ…å†µä¸‹æœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œç‰ˆæƒå½’&nbsp;<a href="https://docs.depy.ink">Depy's docs</a>&nbsp;æ‰€æœ‰ï¼Œè½¬è½½è¯·è”ç³»åšä¸»è·å¾—æˆæƒã€‚</h5>
                    
                </div>
            </article>

            

    <div class="ad d-none d-lg-block">
        
        <div style="margin-left: 20px;margin-bottom:15px;font-weight:bold"> ã€ç›®å½•ã€ </div>
    <div class="anchorContent" id="anchorContent"> </div>
            
                        
                       </div>
    
            </div>
    </section>
    <button class="sidebar-toggle sidebar-toggle-button" aria-label="Menu">
        <div><span></span><span></span><span></span></div>
    </button>


    
</main>

<link href="https://file.depy.ink/theme/docs/css/prettify.css?v=5530" rel="stylesheet">
<script src="https://file.depy.ink/theme/docs/js/prettify.js?v=5764"></script>
<script src="https://file.depy.ink/theme/docs/js/view.js?v=4125"></script>


        
<script>


    // å®šä¹‰æ°´å°å‡½æ•°
    function addWatermark({
        container = document.body, // æ°´å°æ·»åŠ åˆ°çš„å®¹å™¨ï¼Œé»˜è®¤ä¸º body
        width = "220px", // æ°´å° canvas çš„å®½åº¦
        height = "160px", // æ°´å° canvas çš„é«˜åº¦
        textAlign = "center", // æ°´å°æ–‡å­—çš„å¯¹é½æ–¹å¼
        textBaseline = "middle", // æ°´å°æ–‡å­—çš„åŸºçº¿
        font = "16px Microsoft Yahei", // æ°´å°æ–‡å­—çš„å­—ä½“
        fillStyle = "rgba(184, 184, 184, 0.6)", // æ°´å°æ–‡å­—çš„å¡«å……æ ·å¼
        content = "depy|rce.ink", // æ°´å°æ–‡å­—çš„å†…å®¹
        rotate = "45", // æ°´å°æ–‡å­—çš„æ—‹è½¬è§’åº¦
        zIndex = 10000, // æ°´å°çš„ z-index å€¼
    }) {
        // ç”Ÿæˆæ°´å° canvas
        const canvas = document.createElement("canvas");
        canvas.setAttribute("width", width);
        canvas.setAttribute("height", height);
        const ctx = canvas.getContext("2d");
        ctx.textAlign = textAlign;
        ctx.textBaseline = textBaseline;
        ctx.font = font;
        ctx.fillStyle = fillStyle;
        ctx.rotate((Math.PI / 180) * rotate);
        ctx.fillText(content, parseFloat(width) / 2, parseFloat(height) / 2);

        // å°† canvas è½¬æ¢ä¸º base64 URL
        const base64Url = canvas.toDataURL();
        const __wm = document.querySelector('.__wm');
        const watermarkDiv = __wm || document.createElement("div");
        const styleStr = `
                    position: fixed;
                    top: -70px;
                    left: 0;
                    bottom: 0;
                    right: 0;
                    width: 100%;
                    height: 100%;
                    z-index: ${zIndex};
                    pointer-events: none;
                    background-repeat: repeat;
                    background-image: url('${base64Url}')
                `;
        watermarkDiv.setAttribute("style", styleStr);
        watermarkDiv.classList.add("__wm"); 
        //åˆ™åˆ›å»ºä¸€ä¸ª div å¹¶è®¾ç½®æ ·å¼å’Œç±»å

        if (!__wm) {
            container.style.position = 'relative';
            container.insertBefore(watermarkDiv, container.firstChild);
        }
            // ç›‘å¬å®¹å™¨å˜åŒ–ï¼Œå½“å®¹å™¨å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°è°ƒç”¨ addWatermark å‡½æ•°
            const MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
            if (MutationObserver) {
                let mo = new MutationObserver(function () {
                    const __wm = document.querySelector('.__wm');
                    // åªåœ¨__wmå…ƒç´ å˜åŠ¨æ‰é‡æ–°è°ƒç”¨__canvasWM
                    if ((__wm && __wm.getAttribute('style') !== styleStr) || !__wm) {
                        // é¿å…ä¸€ç›´è§¦å‘
                        mo.disconnect();
                        mo = null;
                        console.log('1');
                        addWatermark({
                            container: document.getElementById("watermark"),
                            width: "220px",
                            height: "160px",
                            textAlign: "center",
                            textBaseline: "middle",
                            font: "16px Microsoft Yahei",
                            fillStyle: "rgba(184, 184, 184, 0.3 )",
                            content: "depy|rce.ink",
                            rotate: "30",
                            zIndex: 10000,
                        });
                    }
                });

                mo.observe(container, {
                    attributes: true,
                    subtree: true,
                    childList: true
                });
            }
    }



    function addwm(){
    addWatermark({
        container: document.getElementById("watermark"),
        width: "220px",
        height: "160px",
        textAlign: "center",
        textBaseline: "middle",
        font: "16px Microsoft Yahei",
        fillStyle: "rgba(184, 184, 184, 0.3 )",
        content: "depy|rce.ink",
        rotate: "30",
        zIndex: 10000,
    });
}

addwm();
</script>
        
</body>
</html>