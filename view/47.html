<!doctype html>
<html lang="zh-cn" >
<head>
    <meta charset="utf-8">
    <link rel="icon" href="data:image/ico;base64,aWNv">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://file.depy.ink/theme/docs/css/bootstrap.min.css?v=8280" rel="stylesheet">
    <link href="https://file.depy.ink/theme/docs/css/main.css?v=3525" rel="stylesheet">
    <script src="https://file.depy.ink/theme/docs/js/jquery.min.js"></script>
    <script src="https://file.depy.ink/theme/docs/js/bootstrap.min.js?v=4094"></script>
    <script src="https://file.depy.ink/theme/docs/js/functions.js?v=8141"></script>
    <script src="https://file.depy.ink/theme/docs/js/marked.min.js"></script>
    <link href="https://file.depy.ink/theme/docs/css/doc.css?v=4299" rel="stylesheet">
    <link rel="stylesheet" href="https://file.depy.ink/assets/editor/editormd/css/editormd.css?v=6567" />
    <script src="https://file.depy.ink/assets/editor/editormd/editormd.js"></script>
    <script src="https://file.depy.ink/assets/editor/editormd/lib/marked.min.js"></script>
    <script src="https://file.depy.ink/assets/editor/editormd/lib/prettify.min.js"></script>

    <script src="https://file.depy.ink/theme/docs/js/pjax.min.js"></script>
    


    <script src="https://file.depy.ink/theme/docs/js/lightbox-plus-jquery.min.js"> </script>
    <link href="https://file.depy.ink/theme/docs/css/lightbox.css?v=3328" rel="stylesheet"><title>ğŸ“‘ ç§Ÿæˆ·è‡ªå®šä¹‰åŸŸåç»‘å®š</title>
</head>

<body class="bg-light ready sticky" id="watermark">


             <nav class="navbar navbar-expand-lg navbar-light shadow-sm bg-white mybt2 sticky-top">
        <div class="container-fluid" style="max-width:1332px;">
            <a class="navbar-brand" href="/"><b class="">Depy's docs</b></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="/" >é¦–é¡µ</a>
                    </li>

                </ul>

            </div>
        </div>
    </nav>


<main>


<aside class="sidebar">
           <div class="sidebar-nav mt-2">
            <ul>
            <li>

 <p>æµ‹è¯•ç¬”è®°</p>
    <ul>
<li><a href="/view/129.html">å…³äºDDOSæˆ‘èƒ½åšä»€ä¹ˆ</a></li>
<li><a href="/view/123.html">ğŸ‘ æŸåŠ å¯†æ ·æœ¬ Traceåˆ†æ - 2</a></li>
<li><a href="/view/121.html">ğŸ‘ æŸåŠ å¯†æ ·æœ¬ Traceåˆ†æ</a></li>
<li><a href="/view/115.html">ğŸ”§ è½»é‡çº§CI/CD+æ–‡ä»¶å†…å®¹ç›‘æ§/é˜²ç¯¡æ”¹è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="/view/105.html">ğŸ¯ æœ‰ç”¨çš„å‘½ä»¤å¤‡ä»½</a></li>
<li><a href="/view/94.html">ğŸ˜Š Gateway-wokerå®ç°çƒ­é‡è½½</a></li>
<li><a href="/view/90.html">âœï¸ Xposedè¿è¡ŒåŸç†</a></li>
<li><a href="/view/89.html">AutoJS æ¨¡æ‹Ÿè´å¡å°”æ›²çº¿è§†é¢‘æ»‘åŠ¨</a></li>
<li><a href="/view/84.html">ğŸ“± å°ç±³13ç»•è¿‡SIMå¡æ‰“å¼€USBå®‰è£…</a></li>
    </ul>
 <p>è¯»ä¹¦ç¬”è®°</p>
    <ul>
<li><a href="/view/119.html">ğŸ“š æ³¨å…¥ä¸HOOK</a></li>
<li><a href="/view/117.html">ğŸ“šã€Šæ·±å…¥æ¢ç´¢å®‰å“çƒ­ä¿®å¤æŠ€æœ¯åŸç†ã€‹32 -</a></li>
<li><a href="/view/112.html">ğŸ“šã€Šæ·±å…¥æ¢ç´¢å®‰å“çƒ­ä¿®å¤æŠ€æœ¯åŸç†ã€‹1-32</a></li>
<li><a href="/view/82.html">ğŸ“šã€Šé€†å‘å·¥ç¨‹æƒå¨æŒ‡å—ã€‹ - 1-4ç« </a></li>
    </ul>
 <p>ç¼–ç¨‹å¼€å‘</p>
    <ul>
<li><a href="/view/111.html">ğŸŒ¹ Dobbyä½¿ç”¨</a></li>
<li><a href="/view/77.html">ğŸ“‘ã€å‰ç«¯å¼€å‘ã€‘lightbox+pjaxæœ€ä½³å®è·µ</a></li>
<li><a href="/view/71.html">ğŸ“‘ã€NDKå¼€å‘ã€‘NDKé‡‡é›†ã€å‹ç¼©ã€åŠ å¯†ä¼ è¾“è®¾å¤‡ä¿¡æ¯</a></li>
<li><a href="/view/70.html">ğŸ“‘ã€NDKå¼€å‘ã€‘åŸºç¡€ç¯å¢ƒæ­å»º</a></li>
    </ul>
 <p>é€†å‘åˆ†æ</p>
    <ul>
<li><a href="/view/86.html">âš™ï¸ ã€Xposed æ”¹æœºã€‘- åŸºç¡€ç¯å¢ƒå®‰è£…</a></li>
<li><a href="/view/81.html">ğŸ’» å®‰å“å†…è”æ±‡ç¼–å¼€å‘</a></li>
<li><a href="/view/76.html">ğŸ“‘ JNI ä½¿ç”¨åŸºç¡€</a></li>
<li><a href="/view/75.html">ğŸ“‘ IDA Debugger è°ƒè¯•å™¨ä½¿ç”¨</a></li>
<li><a href="/view/74.html">ğŸ’» std::stringå†…å­˜å¸ƒå±€</a></li>
<li><a href="/view/73.html">ğŸ’¼ Fridaä½œä¸š-20231114</a></li>
<li><a href="/view/65.html">ğŸ§® JSVMPæ‰§è¡Œæµç¨‹åˆ†æ</a></li>
    </ul>
 <p>DepyDocs</p>
    <ul>
<li><a href="/view/122.html">ğŸ“‘ DepyDocs</a></li>
<li><a href="/view/120.html">ğŸ“‘  Un1kMsgä½¿ç”¨</a></li>
<li><a href="/view/114.html">ğŸ“‘ è”ç³»æ–¹å¼</a></li>
<li><a href="/view/91.html">ğŸ“‘ é¢å¤–é…ç½®</a></li>
<li><a href="/view/88.html">ğŸ“‘  æ›´æ–°æ—¥å¿—</a></li>
<li><a href="/view/72.html">ğŸ“‘ æ—¶å…‰æœºä½¿ç”¨</a></li>
<li><a href="/view/66.html">ğŸ“‘ DepyOauthæ¥å…¥æŒ‡å—</a></li>
<li><a href="/view/62.html">ğŸ“‘ å®˜æ–¹åŸŸåç”³è¯·</a></li>
<li><a href="/view/47.html">ğŸ“‘ ç§Ÿæˆ·è‡ªå®šä¹‰åŸŸåç»‘å®š</a></li>
    </ul>
 <p>Todo</p>
    <ul>
<li><a href="/view/118.html">Todo List</a></li>
    </ul>
 <p>éšç¬”</p>
    <ul>
<li><a href="/view/128.html">å°å¹´</a></li>
<li><a href="/view/109.html">â¤ 2023</a></li>
    </ul>


</li>
</ul></div>
</aside><section class="content mx-auto" id="article">
        <div class="d-flex">



            <article class="markdown-section" id="main" style="word-break:break-all;">
                <div>
                <h1>ğŸ“‘ ç§Ÿæˆ·è‡ªå®šä¹‰åŸŸåç»‘å®š</h1>


                <a style="font-size:12px;color: #5f5d5d;">
                | æ—¶é—´: 2023-10-06 21:31:43| ç›®å½•:DepyDocs </a>
                |
                <a style="font-size:12px;color: #007bff;" href="http://10.8.0.3:5080/tenantadmin/Tenantarticle/quickedit/quickedit.html?id=118" target="_blank">ç¼–è¾‘æœ¬æ–‡</a>
                <br>


                    <div id="content"><textarea style="display: none;">## ä»‹ç»
DepyDocsæä¾›åŸŸåç»‘å®šçš„åŠŸèƒ½ï¼Œä¾›ç”¨æˆ·å®šåˆ¶åŒ–ä½¿ç”¨æœåŠ¡ï¼Œæœ¬äººæä¾›æä¾›ä»¥ä¸‹ä¸¤ç§ç»‘å®šæ–¹å¼ã€‚
### åŸºäºNginxåå‘ä»£ç†ï¼ˆéœ€è¦æœåŠ¡å™¨ï¼‰
åŸŸåè§£ææœåŠ¡å™¨åä½¿ç”¨nginxåå‘ä»£ç†ï¼Œé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼Œæ³¨æ„ä¿®æ”¹ç§Ÿæˆ·idã€‚
```bash
#PROXY-START/

location ^~ /
{
    proxy_pass https://rce.ink/index/tenant/ç§Ÿæˆ·id/;
    proxy_set_header Host rce.ink;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header REMOTE-HOST $remote_addr;
    
    add_header X-Cache $upstream_cache_status;
    
    #Set Nginx Cache
    
    
    set $static_fileB0Aqg0HO 0;
    if ( $uri ~* &#34;\.(gif|png|jpg|css|js|woff|woff2)$&#34; )
    {
    	set $static_fileB0Aqg0HO 1;
    	expires 12h;
        }
    if ( $static_fileB0Aqg0HO = 0 )
    {
    add_header Cache-Control no-cache;
    }
}

#PROXY-END/
```

### åŸºäºCloudFlare Workersï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰
ä¿®æ”¹DNSæœåŠ¡å™¨ä¸ºcloudflareæä¾›çš„DNSæœåŠ¡å™¨ã€‚
![](https://p1.meituan.net/xianfu/a3c71cb47835f44ad4b2c50428b4c9709238.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)
è§£ææˆåŠŸåï¼Œè®¿é—®
![](https://p0.meituan.net/xianfu/4846ff3283221d83d5de95d26b1b083198878.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)
![](https://p0.meituan.net/xianfu/132aefef4294339b54cdc522b82f97d195614.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

ç‚¹å‡»éƒ¨ç½²åï¼Œé‡æ–°è¿›å…¥ç¼–è¾‘ç•Œé¢ï¼Œæ›¿æ¢ä»£ç ä¸ºä¸‹é¢çš„ä»£ç ã€‚
```javascript
// ç›®æ ‡ç½‘ç«™
const upstream = &#39;rce.ink&#39;

// ç›®æ ‡ç½‘ç«™è·¯å¾„
const upstream_path = &#39;/index/tenant/ç§Ÿæˆ·id/&#39;

// æ‰“ç®—ä¸ºä½¿ç”¨ç§»åŠ¨è®¾å¤‡çš„ç”¨æˆ·æ£€ç´¢çš„ç½‘ç«™.
const upstream_mobile = &#39;rce.ink&#39;

// æ‚¨å¸Œæœ›æš‚åœæœåŠ¡çš„å›½å®¶å’Œåœ°åŒº
const blocked_region = []

// è¦é˜»æ­¢å…¶ä½¿ç”¨æœåŠ¡çš„IPåœ°å€
const blocked_ip_address = [&#39;0.0.0.0&#39;, &#39;127.0.0.1&#39;]

// ä¸Šæ¸¸åœ°å€æ˜¯å¦ä½¿ç”¨HTTPSåè®®
const https = true

// æ˜¯å¦ç¦ç”¨ç¼“å­˜
const disable_cache = false

// æ›¿æ¢æ–‡æœ¬
//æ ¼å¼ï¼š  &#39;è¢«æ›¿æ¢&#39;:&#39;æ›¿æ¢&#39;
//æ³¨æ„jsç»“æŸçš„çš„é€—å·
const replace_dict = {
    // &#39;www.google.com&#39;:&#39;yourworkername.yourusername.workers.dev&#39;
}

let data={}
addEventListener(&#39;fetch&#39;, event =&gt; {
    event.respondWith(fetchAndApply(event.request));
})

async function fetchAndApply(request) {
    const region = request.headers.get(&#39;cf-ipcountry&#39;).toUpperCase();
    const ip_address = request.headers.get(&#39;cf-connecting-ip&#39;);
    const user_agent = request.headers.get(&#39;user-agent&#39;);

    let response = null;
    let url = new URL(request.url);
    let url_hostname = url.hostname;

    if (https == true) {
        url.protocol = &#39;https:&#39;;
    } else {
        url.protocol = &#39;http:&#39;;
    }

    if (await device_status(user_agent)) {
        var upstream_domain = upstream;
    } else {
        var upstream_domain = upstream_mobile;
    }

    url.host = upstream_domain;
    if (url.pathname == &#39;/&#39;) {
        url.pathname = upstream_path;
    } else {
        url.pathname = upstream_path &#43; url.pathname;
    }

    if (blocked_region.includes(region)) {
        response = new Response(&#39;æ‹’ç»è®¿é—®: æ‚¨æ‰€åœ¨çš„åœ°åŒºä¸å¯ç”¨!&#39;, {
            status: 403
        });
    } else if (blocked_ip_address.includes(ip_address)) {
        response = new Response(&#39;æ‹’ç»è®¿é—®: æ‚¨çš„IPåœ°å€åœ¨Banåˆ—è¡¨ä¸­!&#39;, {
            status: 403
        });
    } else {
        let method = request.method;
        let request_headers = request.headers;
        let new_request_headers = new Headers(request_headers);

        new_request_headers.set(&#39;Host&#39;, upstream_domain);
        new_request_headers.set(&#39;Referer&#39;, url.protocol &#43; &#39;//&#39; &#43; upstream_domain);

        

        if(method == &#39;POST&#39;){
            let origin_formData = await request.text()
            data = {
                method: method,
                headers: new_request_headers,
                body : origin_formData
            }
            console.log(data)
        }else if(method == &#39;GET&#39;){
            data = {
                method: method,
                headers: new_request_headers
            }
        }
        let fuckKeys =  Object.fromEntries(new_request_headers)
        console.log(method)
        console.log(fuckKeys)
        let original_response = await fetch(url.href, data)

        connection_upgrade = new_request_headers.get(&#34;Upgrade&#34;);
        if (connection_upgrade && connection_upgrade.toLowerCase() == &#34;websocket&#34;) {
            return original_response;
        }

        let original_response_clone = original_response.clone();
        let original_text = null;
        let response_headers = original_response.headers;
        let new_response_headers = new Headers(response_headers);
        let status = original_response.status;
		
		if (disable_cache) {
			new_response_headers.set(&#39;Cache-Control&#39;, &#39;no-store&#39;);
	    }

        new_response_headers.set(&#39;access-control-allow-origin&#39;, &#39;*&#39;);
        new_response_headers.set(&#39;access-control-allow-credentials&#39;, true);
        new_response_headers.delete(&#39;content-security-policy&#39;);
        new_response_headers.delete(&#39;content-security-policy-report-only&#39;);
        new_response_headers.delete(&#39;clear-site-data&#39;);
		
		if (new_response_headers.get(&#34;x-pjax-url&#34;)) {
            new_response_headers.set(&#34;x-pjax-url&#34;, response_headers.get(&#34;x-pjax-url&#34;).replace(&#34;//&#34; &#43; upstream_domain, &#34;//&#34; &#43; url_hostname));
        }
		
        const content_type = new_response_headers.get(&#39;content-type&#39;);
        if (content_type != null && content_type.includes(&#39;text/html&#39;) && content_type.includes(&#39;UTF-8&#39;)) {
            original_text = await replace_response_text(original_response_clone, upstream_domain, url_hostname);
        } else {
            original_text = original_response_clone.body
        }
		
        response = new Response(original_text, {
            status,
            headers: new_response_headers
        })
    }
    
    return response;
}

async function replace_form_data(formData, upstream_domain, host_name) {
    let text = await response.text()

    var i, j;
    for (i in replace_dict) {
        j = replace_dict[i]
        if (i == &#39;$upstream&#39;) {
            i = upstream_domain
        } else if (i == &#39;$custom_domain&#39;) {
            i = host_name
        }

        if (j == &#39;$upstream&#39;) {
            j = upstream_domain
        } else if (j == &#39;$custom_domain&#39;) {
            j = host_name
        }

        let re = new RegExp(i, &#39;g&#39;)
        text = text.replace(re, j);
    }
    return text;
}

async function replace_response_text(response, upstream_domain, host_name) {
    let text = await response.text()

    var i, j;
    for (i in replace_dict) {
        j = replace_dict[i]
        if (i == &#39;$upstream&#39;) {
            i = upstream_domain
        } else if (i == &#39;$custom_domain&#39;) {
            i = host_name
        }

        if (j == &#39;$upstream&#39;) {
            j = upstream_domain
        } else if (j == &#39;$custom_domain&#39;) {
            j = host_name
        }

        let re = new RegExp(i, &#39;g&#39;)
        text = text.replace(re, j);
    }
    return text;
}


async function device_status(user_agent_info) {
    var agents = [&#34;Android&#34;, &#34;iPhone&#34;, &#34;SymbianOS&#34;, &#34;Windows Phone&#34;, &#34;iPad&#34;, &#34;iPod&#34;];
    var flag = true;
    for (var v = 0; v &lt; agents.length; v&#43;&#43;) {
        if (user_agent_info.indexOf(agents[v]) &gt; 0) {
            flag = false;
            break;
        }
    }
    return flag;
}
```
### æ³¨æ„
è¯·åœ¨åå°ç»‘å®šåŸŸåï¼Œå¦åˆ™ä¼šå¯¼è‡´èµ„æºé”™è¯¯ã€‚</textarea></div>


                <script>
                   $(function () {
                        
                        editormd.markdownToHTML("content");
                    })

                </script>




                </div>

                <hr>


                <div>
                    <h5>Â© ç‰ˆæƒå£°æ˜ï¼šéæ ‡æ³¨ã€è½¬è½½ã€æƒ…å†µä¸‹æœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œç‰ˆæƒå½’&nbsp;<a href="/">Depy's docs</a>&nbsp;æ‰€æœ‰ï¼Œè½¬è½½è¯·è”ç³»åšä¸»è·å¾—æˆæƒã€‚</h5>
                </div>

            </article>



    <div class="ad d-none d-lg-block">

        <div style="margin-left: 20px;margin-bottom:15px;font-weight:bold"> ã€ç›®å½•ã€ </div>
    <div class="anchorContent" id="anchorContent"> </div>
                       </div>

            </div>
    </section>
    <button class="sidebar-toggle sidebar-toggle-button" aria-label="Menu">
        <div><span></span><span></span><span></span></div>
    </button>

</main>

<link href="https://file.depy.ink/theme/docs/css/prettify.css?v=5530" rel="stylesheet">
<script src="https://file.depy.ink/theme/docs/js/prettify.js?v=5764"></script>
<script src="https://file.depy.ink/theme/docs/js/view.js?v=4125"></script>



<script>


    
    function addWatermark({
        container = document.body, 
        width = "220px", 
        height = "160px", 
        textAlign = "center", 
        textBaseline = "middle", 
        font = "16px Microsoft Yahei", 
        fillStyle = "rgba(184, 184, 184, 0.6)", 
        content = "depy|rce.ink", 
        rotate = "45", 
        zIndex = 10000, 
    }) {
        
        const canvas = document.createElement("canvas");
        canvas.setAttribute("width", width);
        canvas.setAttribute("height", height);
        const ctx = canvas.getContext("2d");
        ctx.textAlign = textAlign;
        ctx.textBaseline = textBaseline;
        ctx.font = font;
        ctx.fillStyle = fillStyle;
        ctx.rotate((Math.PI / 180) * rotate);
        ctx.fillText(content, parseFloat(width) / 2, parseFloat(height) / 2);

        
        const base64Url = canvas.toDataURL();
        const __wm = document.querySelector('.__wm');
        const watermarkDiv = __wm || document.createElement("div");
        const styleStr = `
                    position: fixed;
                    top: -70px;
                    left: 0;
                    bottom: 0;
                    right: 0;
                    width: 100%;
                    height: 100%;
                    z-index: ${zIndex};
                    pointer-events: none;
                    background-repeat: repeat;
                    background-image: url('${base64Url}')
                `;
        watermarkDiv.setAttribute("style", styleStr);
        watermarkDiv.classList.add("__wm");
        

        if (!__wm) {
            container.style.position = 'relative';
            container.insertBefore(watermarkDiv, container.firstChild);
        }
            
            const MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
            if (MutationObserver) {
                let mo = new MutationObserver(function () {
                    const __wm = document.querySelector('.__wm');
                    
                    if ((__wm && __wm.getAttribute('style') !== styleStr) || !__wm) {
                        
                        mo.disconnect();
                        mo = null;
                        console.log('1');
                        addWatermark({
                            container: document.getElementById("watermark"),
                            width: "220px",
                            height: "160px",
                            textAlign: "center",
                            textBaseline: "middle",
                            font: "16px Microsoft Yahei",
                            fillStyle: "rgba(184, 184, 184, 0.3 )",
                            content: "depy|rce.ink",
                            rotate: "30",
                            zIndex: 10000,
                        });
                    }
                });

                mo.observe(container, {
                    attributes: true,
                    subtree: true,
                    childList: true
                });
            }
    }



    function addwm(){
    addWatermark({
        container: document.getElementById("watermark"),
        width: "220px",
        height: "160px",
        textAlign: "center",
        textBaseline: "middle",
        font: "16px Microsoft Yahei",
        fillStyle: "rgba(184, 184, 184, 0.3 )",
        content: "depy|rce.ink",
        rotate: "30",
        zIndex: 10000,
    });
}

addwm();
</script>

</body>
</html>