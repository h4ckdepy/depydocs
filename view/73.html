<!doctype html>
<html lang="zh-cn" >
<head>
    <meta charset="utf-8">
    <link rel="icon" href="data:image/ico;base64,aWNv">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://file.depy.ink/theme/docs/css/bootstrap.min.css?v=8280" rel="stylesheet">
    <link href="https://file.depy.ink/theme/docs/css/main.css?v=3525" rel="stylesheet">
    <script src="https://file.depy.ink/theme/docs/js/jquery.min.js"></script>
    <script src="https://file.depy.ink/theme/docs/js/bootstrap.min.js?v=4094"></script>
    <script src="https://file.depy.ink/theme/docs/js/functions.js?v=8141"></script>
    <script src="https://file.depy.ink/theme/docs/js/marked.min.js"></script>
    <link href="https://file.depy.ink/theme/docs/css/doc.css?v=4299" rel="stylesheet">
    <link rel="stylesheet" href="https://file.depy.ink/assets/editor/editormd/css/editormd.css?v=6567" />
    <script src="https://file.depy.ink/assets/editor/editormd/editormd.js"></script>
    <script src="https://file.depy.ink/assets/editor/editormd/lib/marked.min.js"></script>
    <script src="https://file.depy.ink/assets/editor/editormd/lib/prettify.min.js"></script>

    <script src="https://file.depy.ink/theme/docs/js/pjax.min.js"></script>
    


    <script src="https://file.depy.ink/theme/docs/js/lightbox-plus-jquery.min.js"> </script>
    <link href="https://file.depy.ink/theme/docs/css/lightbox.css?v=3328" rel="stylesheet"><title>ğŸ’¼ Fridaä½œä¸š-20231114</title>
</head>

<body class="bg-light ready sticky" id="watermark">


             <nav class="navbar navbar-expand-lg navbar-light shadow-sm bg-white mybt2 sticky-top">
        <div class="container-fluid" style="max-width:1332px;">
            <a class="navbar-brand" href="/"><b class="">Depy's docs</b></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="/" >é¦–é¡µ</a>
                    </li>

                </ul>

            </div>
        </div>
    </nav>


<main>


<aside class="sidebar">
           <div class="sidebar-nav mt-2">
            <ul>
            <li>

 <p>åšå®¢æ–‡ç« ï¼ˆå¤‡ä»½ï¼‰</p>
    <ul>
<li><a href="/view/137.html">æµ™æ±Ÿçœç¬¬å››å±Šç½‘ç»œä¸ä¿¡æ¯å®‰å…¨ç«èµ›å†³èµ›WP</a></li>
<li><a href="/view/136.html">æµé‡åŠ å¯†ç¼–ç¨‹å¼€å‘</a></li>
<li><a href="/view/135.html">Attack PHP Website By Shiro</a></li>
<li><a href="/view/134.html">æŸOAæˆæƒç ´è§£åˆ†æ</a></li>
<li><a href="/view/133.html">Un1kHacking</a></li>
<li><a href="/view/132.html">Un1kLog4shellScan </a></li>
<li><a href="/view/131.html">Netty å¼€å‘Mitmè§£å†³è¯·æ±‚å“åº”åŒ¹é…é—®é¢˜	</a></li>
    </ul>
 <p>Todo</p>
    <ul>
<li><a href="/view/118.html">Todo List</a></li>
    </ul>
 <p>éšç¬”</p>
    <ul>
<li><a href="/view/128.html">å°å¹´</a></li>
<li><a href="/view/109.html">â¤ 2023</a></li>
    </ul>
 <p>æµ‹è¯•ç¬”è®°</p>
    <ul>
<li><a href="/view/129.html">ğŸ˜¡ å…³äºDDOSæˆ‘èƒ½åšä»€ä¹ˆ</a></li>
<li><a href="/view/123.html">ğŸ‘ æŸåŠ å¯†æ ·æœ¬ Traceåˆ†æ - 2</a></li>
<li><a href="/view/121.html">ğŸ‘ æŸåŠ å¯†æ ·æœ¬ Traceåˆ†æ</a></li>
<li><a href="/view/115.html">ğŸ”§ è½»é‡çº§CI/CD+æ–‡ä»¶å†…å®¹ç›‘æ§/é˜²ç¯¡æ”¹è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="/view/105.html">ğŸ¯ æœ‰ç”¨çš„å‘½ä»¤å¤‡ä»½</a></li>
<li><a href="/view/94.html">ğŸ˜Š Gateway-wokerå®ç°çƒ­é‡è½½</a></li>
<li><a href="/view/90.html">âœï¸ Xposedè¿è¡ŒåŸç†</a></li>
<li><a href="/view/89.html">AutoJS æ¨¡æ‹Ÿè´å¡å°”æ›²çº¿è§†é¢‘æ»‘åŠ¨</a></li>
<li><a href="/view/84.html">ğŸ“± å°ç±³13ç»•è¿‡SIMå¡æ‰“å¼€USBå®‰è£…</a></li>
    </ul>
 <p>è¯»ä¹¦ç¬”è®°</p>
    <ul>
<li><a href="/view/119.html">ğŸ“š æ³¨å…¥ä¸HOOK</a></li>
<li><a href="/view/117.html">ğŸ“šã€Šæ·±å…¥æ¢ç´¢å®‰å“çƒ­ä¿®å¤æŠ€æœ¯åŸç†ã€‹32 -</a></li>
<li><a href="/view/112.html">ğŸ“šã€Šæ·±å…¥æ¢ç´¢å®‰å“çƒ­ä¿®å¤æŠ€æœ¯åŸç†ã€‹1-32</a></li>
<li><a href="/view/82.html">ğŸ“šã€Šé€†å‘å·¥ç¨‹æƒå¨æŒ‡å—ã€‹ - 1-4ç« </a></li>
    </ul>
 <p>ç¼–ç¨‹å¼€å‘</p>
    <ul>
<li><a href="/view/111.html">ğŸŒ¹ Dobbyä½¿ç”¨</a></li>
<li><a href="/view/77.html">ğŸ“‘ã€å‰ç«¯å¼€å‘ã€‘lightbox+pjaxæœ€ä½³å®è·µ</a></li>
<li><a href="/view/71.html">ğŸ“‘ã€NDKå¼€å‘ã€‘NDKé‡‡é›†ã€å‹ç¼©ã€åŠ å¯†ä¼ è¾“è®¾å¤‡ä¿¡æ¯</a></li>
<li><a href="/view/70.html">ğŸ“‘ã€NDKå¼€å‘ã€‘åŸºç¡€ç¯å¢ƒæ­å»º</a></li>
    </ul>
 <p>é€†å‘åˆ†æ</p>
    <ul>
<li><a href="/view/86.html">âš™ï¸ ã€Xposed æ”¹æœºã€‘- åŸºç¡€ç¯å¢ƒå®‰è£…</a></li>
<li><a href="/view/81.html">ğŸ’» å®‰å“å†…è”æ±‡ç¼–å¼€å‘</a></li>
<li><a href="/view/76.html">ğŸ“‘ JNI ä½¿ç”¨åŸºç¡€</a></li>
<li><a href="/view/75.html">ğŸ“‘ IDA Debugger è°ƒè¯•å™¨ä½¿ç”¨</a></li>
<li><a href="/view/74.html">ğŸ’» std::stringå†…å­˜å¸ƒå±€</a></li>
<li><a href="/view/73.html">ğŸ’¼ Fridaä½œä¸š-20231114</a></li>
<li><a href="/view/65.html">ğŸ§® JSVMPæ‰§è¡Œæµç¨‹åˆ†æ</a></li>
    </ul>
 <p>DepyDocs</p>
    <ul>
<li><a href="/view/122.html">ğŸ“‘ DepyDocs</a></li>
<li><a href="/view/120.html">ğŸ“‘  Un1kMsgä½¿ç”¨</a></li>
<li><a href="/view/114.html">ğŸ“‘ è”ç³»æ–¹å¼</a></li>
<li><a href="/view/91.html">ğŸ“‘ é¢å¤–é…ç½®</a></li>
<li><a href="/view/88.html">ğŸ“‘  æ›´æ–°æ—¥å¿—</a></li>
<li><a href="/view/72.html">ğŸ“‘ æ—¶å…‰æœºä½¿ç”¨</a></li>
<li><a href="/view/66.html">ğŸ“‘ DepyOauthæ¥å…¥æŒ‡å—</a></li>
<li><a href="/view/62.html">ğŸ“‘ å®˜æ–¹åŸŸåç”³è¯·</a></li>
<li><a href="/view/47.html">ğŸ“‘ ç§Ÿæˆ·è‡ªå®šä¹‰åŸŸåç»‘å®š</a></li>
    </ul>


</li>
</ul></div>
</aside><section class="content mx-auto" id="article">
        <div class="d-flex">



            <article class="markdown-section" id="main" style="word-break:break-all;">
                <div>
                <h1>ğŸ’¼ Fridaä½œä¸š-20231114</h1>


                <a style="font-size:12px;color: #5f5d5d;">
                | æ—¶é—´: 2023-11-14 19:47:09| ç›®å½•:é€†å‘åˆ†æ </a>
                |
                <a style="font-size:12px;color: #007bff;" href="http://10.8.0.3:5080/tenantadmin/Tenantarticle/quickedit/quickedit.html?id=118" target="_blank">ç¼–è¾‘æœ¬æ–‡</a>
                <br>


                    <div id="content"><textarea style="display: none;">##  Frida Work

1ã€system_property_getçš„è¾“å…¥å’Œè¾“å‡º
2ã€protobuf åºåˆ—åŒ–æ•°æ®
3ã€aesçš„è¾“å…¥ï¼ˆæ˜æ–‡ã€keyã€ivï¼‰ å¯ä»¥å°è¯•èƒ½ä¸èƒ½çœ‹å‡ºæ˜¯pkcs#7çš„å¡«å……å’Œè¾“å‡º

æ ·æœ¬ä¸‹è½½ï¼š//å¾…è¡¥å……

### åŸºç¡€åˆ†æ

ä½¿ç”¨jadxé€†å‘apkã€‚

![](https://p1.meituan.net/xianfu/4083b98b5b0db6402610c0b820e6339d122519.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

å¯ä»¥çŸ¥é“å®ƒè°ƒç”¨un1ksecçš„libåº“ï¼Œå®šä¹‰äº†ä¸€ä¸ªgetçš„nativeæ–¹æ³•ã€‚ä½¿ç”¨idaåˆ†ælibun1ksec.soï¼Œæœç´¢java_æŸ¥æ‰¾å‡½æ•°åï¼Œä»¥ç¡®å®šæ˜¯ä¸æ˜¯é™æ€ç»‘å®šã€‚

![](https://p0.meituan.net/xianfu/cdf85e310c525838627f12c73de28251204416.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

ç¡®å®æ˜¯é™æ€ç»‘å®šï¼Œç›´æ¥æŒ‰tabæŸ¥çœ‹å…·ä½“çš„ä»£ç é€»è¾‘ã€‚

![](https://p0.meituan.net/xianfu/1e2ed7798bb16c38a825183bd7f5315f427031.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

å¯ä»¥å‘ç°å®ƒè°ƒç”¨äº†å¾ˆå¤šæ¬¡sub_310088çš„æ–¹æ³•ï¼Œä¸sub_131a58çš„æ–¹æ³•ã€‚

è·Ÿè¿›sub_310388ï¼Œåˆ¤æ–­å¯èƒ½æ˜¯å¯¹å­—ç¬¦ä¸²è¿›è¡Œåˆå§‹åŒ–æˆ–æ„é€ ã€‚

![](https://p0.meituan.net/xianfu/5df44fbcc8398e5b552b56c4793a275274566.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

è·Ÿè¿›sub_13158

![](https://p0.meituan.net/xianfu/d269f2f5f7472d5722e0306875371e33137891.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

### Hook __system_property_get
å‘ç°ç›´æ¥å»è°ƒç”¨äº†system_property_getå‡½æ•°ï¼Œç»“åˆå‰é¢çš„å…¥å‚ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°å¤§æ¦‚æ˜¯ç”¨æ¥è·å–è®¾å¤‡å±æ€§çš„ã€‚

æ‰¾åˆ°æ­¤å‡½æ•°çš„åç§»åœ°å€ï¼Œæˆ‘æ‰¾çš„æ˜¯è¾ƒåº•å±‚çš„pltåœ°å€ï¼Œç”±äºfrida Hookä¼šç ´åå½“å‰åœ°å€åçš„å‡ æ¡æŒ‡ä»¤ï¼Œå¦‚æœå‡½æ•°ä»£ç é‡å¤§å¯ä»¥ç­‰å¾…fridaä¿®å¤åç»§ç»­æ‰§è¡Œã€‚ä½†æ˜¯è¿™ä¸ªå‡½æ•°å¤ªçŸ­äº†ï¼Œå¦‚æœhookå‡½æ•°å¼€å¤´ä¼šå½±å“æ‰§è¡Œï¼Œæ‰€ä»¥é€‰æ‹©0x694EFCä½œä¸ºæˆ‘ä»¬çš„åç§»ã€‚

![](https://p0.meituan.net/xianfu/3559430bfdcce0c4b2db7e2d3b5fb6eb118115.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

```javascript
function todoOndlopen(libraryName, fn) {
    return new Promise((resolve, reject) =&gt; {
        var exportName = Java.androidVersion &gt;= 8.1 ? &#39;android_dlopen_ext&#39; : &#39;dlopen&#39;;
        var dlopen_ptr = Module.findExportByName(null, exportName);
        if (dlopen_ptr) {
            Interceptor.attach(dlopen_ptr, {
                onEnter: function (args) {
                    var libPath = args[0].readCString();
                    if (libPath.indexOf(libraryName) !== -1) {
                        console.log(`libraryPath: ${libPath}`);
                        this.hook = true
                    }
                },
                onLeave: function (retVal) {
                    if (this.hook) {
                        this.hook = false;
                        console.log(&#39;hooking&#39;)
                        resolve(fn());
                    }
                }
            })
        } else {
            reject(exportName &#43; &#39; not found&#39;)
        }
    })
 }
 
 
 
 function hook(){
    const libraryName = &#39;libun1ksec.so&#39;;
    return todoOndlopen(libraryName, ()=&gt;{
        const libraryName = &#39;libun1ksec.so&#39;;
        let libso = Process.getModuleByName(libraryName);
        var base_addr = Module.findBaseAddress(libraryName);
	console.log(base_addr)
        Interceptor.attach(base_addr.add(0x694EFC), {
            onEnter: function(args) {
                console.log(Memory.readCString(args[0]));
            },
        })
 
    })
 }
 
 
 
 hook()

```

![](https://p1.meituan.net/xianfu/c8813cef8889873e6e5976e179ebe9b1155396.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

#### è¿”å›å€¼å¦‚ä½•Hookï¼Ÿ

å‡½æ•°è°ƒç”¨æ ˆï¼š

0x30F550 -&gt; 0x313A58 -&gt;0x694EF0

æ–¹æ³•1:å…¨å±€Hook __system_property_getï¼Œå¹¶æ‰“å°å †æ ˆã€‚æ‰¾åˆ°æ˜¯ç”±libun1ksec.soè°ƒç”¨çš„ï¼Œæ­¤æ—¶ç›´æ¥æ‰“å°è¿”å›å€¼å³å¯ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```javascript
function todoOndlopen(libraryName, fn) {
    return new Promise((resolve, reject) =&gt; {
        var exportName = Java.androidVersion &gt;= 8.1 ? &#39;android_dlopen_ext&#39; : &#39;dlopen&#39;;
        var dlopen_ptr = Module.findExportByName(null, exportName);
        if (dlopen_ptr) {
            Interceptor.attach(dlopen_ptr, {
                onEnter: function (args) {
                    var libPath = args[0].readCString();
                    if (libPath.indexOf(libraryName) !== -1) {
                        console.log(`libraryPath: ${libPath}`);
                        this.hook = true
                    }
                },
                onLeave: function (retVal) {
                    if (this.hook) {
                        this.hook = false;
                        console.log(&#39;hooking&#39;)
                        resolve(fn());
                    }
                }
            })
        } else {
            reject(exportName &#43; &#39; not found&#39;)
        }
    })
 }
 
 
 
 function hook(){
    const libraryName = &#39;libun1ksec.so&#39;;
        return todoOndlopen(libraryName, ()=&gt;{
            const libraryName = &#39;libun1ksec.so&#39;;
            let libso = Process.getModuleByName(libraryName);
            let buffer = null;
            var base_addr = Module.findBaseAddress(libraryName);


            //int __system_property_get(const char *name, char *value)  å‚æ•°1æ˜¯å±æ€§å å‚æ•°2æ˜¯buffer è¿”å›å€¼æ˜¯å±æ€§å€¼çš„å­—ç¬¦ä¸²é•¿åº¦
            Interceptor.attach(Module.findExportByName(null, &#34;__system_property_get&#34;),
            {
                onEnter: function (args) {
                    this.flag = false
                    let backtrace = Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join(&#39;\n&#39;);
                    if(backtrace.indexOf(&#39;un1ksec&#39;) != -1){
                        this.flag = true;
                        this.buffer = args[1]
                        console.log(&#34;name:&#34;&#43;Memory.readCString(args[0]))
                        console.log(&#39;RegisterNatives called from:\n&#39; &#43; Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join(&#39;\n&#39;) &#43; &#39;\n&#39;);
                    }
                },
                onLeave: function (retval) {
                    if(this.flag){
                        this.flag = false;
                        console.log(&#34;value:&#34;&#43;Memory.readCString(this.buffer))
                        console.log(&#34;----------------------------&#34;)
                    }

                }
            }


        );
    
    })
 }
 
 
 
 hook()

```
![](https://p0.meituan.net/xianfu/f090c2c14509d9c05073301a291b8f281357258.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

æ–¹æ³•2:æ±‡ç¼–å±‚é¢åˆ†æè°ƒç”¨

è™½ç„¶æˆ‘ä»¬èƒ½åœ¨0x694EFCå¤„è·å–å‡½æ•°å…¥ï¼Œå‚ä½†æ˜¯æˆ‘ä»¬æ²¡åŠæ³•åœ¨æ­¤å¤„è·å–è¿”å›å€¼ï¼ŒåŸå› åŒä¸Šã€‚æ‰€ä»¥éœ€è¦åˆ†æä¸€ä¸‹å‡½æ•°çš„è°ƒç”¨ä¸è¿”å›å€¼ä¼ é€’è¿‡ç¨‹ï¼š

å…¥å‚ä¼ é€’ï¼š
å±‚çº§1 -&gt; å±‚çº§2 -&gt;å±‚çº§3
è¿”å›å€¼ä¼ é€’ï¼š
å±‚çº§3 -&gt;å±‚çº§2 -&gt; å±‚çº§1

æŸ¥çœ‹æ­¤å¤„çš„æ±‡ç¼–ä»£ç ï¼š

![](https://p0.meituan.net/xianfu/34e28587877c39b5eeb79c4f8ddd94cb243854.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

é¦–å…ˆï¼Œå°†å¯„å­˜å™¨X1çš„å€¼å­˜å‚¨åˆ°æ ˆä¸­çš„æŸä¸ªä½ç½®ï¼Œç„¶åè°ƒç”¨äº†ä¸€ä¸ªè·å–ç³»ç»Ÿå±æ€§çš„å‡½æ•°ï¼Œæœ€åå°†è·å–åˆ°çš„å€¼åŠ è½½åˆ°å¯„å­˜å™¨X1ä¸­ã€‚ä½¿ç”¨Fridaç›´æ¥Hookæ­¤æ—¶çš„å¯„å­˜å™¨çš„å€¼ã€‚

é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€‰æ‹©åç§»ä¸º 0x313A94çš„æ—¶æœºå»hookè¿”å›å€¼ï¼Œæ­¤æ—¶å¯„å­˜å™¨å·²è¢«èµ‹å€¼ã€‚


```javascript
function todoOndlopen(libraryName, fn) {
    return new Promise((resolve, reject) =&gt; {
        var exportName = Java.androidVersion &gt;= 8.1 ? &#39;android_dlopen_ext&#39; : &#39;dlopen&#39;;
        var dlopen_ptr = Module.findExportByName(null, exportName);
        if (dlopen_ptr) {
            Interceptor.attach(dlopen_ptr, {
                onEnter: function (args) {
                    var libPath = args[0].readCString();
                    if (libPath.indexOf(libraryName) !== -1) {
                        console.log(`libraryPath: ${libPath}`);
                        this.hook = true
                    }
                },
                onLeave: function (retVal) {
                    if (this.hook) {
                        this.hook = false;
                        console.log(&#39;hooking&#39;)
                        resolve(fn());
                    }
                }
            })
        } else {
            reject(exportName &#43; &#39; not found&#39;)
        }
    })
 }
 
 
 
 function hook(){
    const libraryName = &#39;libun1ksec.so&#39;;
    return todoOndlopen(libraryName, ()=&gt;{
        const libraryName = &#39;libun1ksec.so&#39;;
        let libso = Process.getModuleByName(libraryName);
        let buffer = null;
        var base_addr = Module.findBaseAddress(libraryName);

        Interceptor.attach(base_addr.add(0x313A94), {
            onEnter: function(args) {
                console.log(Memory.readCString(this.context.x1));
            }

        })
 
    })
 }
 
 
 
 hook()

```

![](https://p1.meituan.net/xianfu/806d739a5e6f1491c11c40e5a984afa7190730.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

ç»¼ä¸Šï¼Œè®°ä½lilacè¯´çš„ä¸¤ä¸ªè¦ç‚¹ï¼š

* ä¸hookè¾ƒçŸ­çš„å‡½æ•°
* åˆæœŸå°½é‡ä½¿ç”¨å‡½æ•°hookè€Œä¸æ˜¯inline hook

### Hook protobuf åºåˆ—åŒ–æ•°æ®

![](https://p0.meituan.net/xianfu/8f4023fd9cbba42c5b088477cc821cb3278883.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

å‡ºç°æ˜æ˜¾çš„æ ‡å¿—google::protobuf::internal::ArenaStringPtr::Setï¼Œæ˜¯protobufè¿›è¡Œç»“æ„ä½“æ•°æ®å±æ€§è®¾ç½®çš„åœ°æ–¹ã€‚

google::protobuf::MessageLite::SerializeToString(v64, v39); æ˜¯å°†æ•°æ®è¿›è¡Œåºåˆ—åŒ–è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥è§‚æµ‹ä¸€ä¸‹å®ƒçš„è¿”å›å€¼ã€‚æ­¤æ—¶æŸ¥çœ‹æ­¤å‡½æ•°çš„è¿”å›å€¼å®šä¹‰ï¼š

![](https://p1.meituan.net/xianfu/89126b82aec9311e49463150c0d6eb1029203.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

æ˜¯å®šä¹‰åœ¨å‚æ•°ä¸­çš„std::stringç±»å‹çš„æŒ‡é’ˆï¼Œå†™äº†ä¸€ç¯‡æ–‡ç« å…³äºæ­¤ç»“æ„ä½“çš„å†…å­˜å¸ƒå±€ï¼šhttps://docs.rce.ink/view/?view_id=74

hook ä¸€ä¸‹
![](https://p0.meituan.net/xianfu/da3b03b25fb4522d5b2c72f40b5daf56257825.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

```
             0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF
7fe80b3280  c1 00 00 00 00 00 00 00 b0 00 00 00 00 00 00 00  ................
7fe80b3290  80 e4 aa 12 74 00 00 b4

```
æ ¹æ®æ–‡ç« ï¼Œç¬¬ä¸€ä¸ª8å­—èŠ‚ç¬¬ä¸€ä½ä»£è¡¨capï¼Œç¬¬äºŒä¸ª8å­—èŠ‚ç¬¬ä¸€ä½ä»£è¡¨æ•°æ®lengthï¼Œæœ€å8å­—èŠ‚ä»£è¡¨dataå­˜å‚¨çš„åœ°å€ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è·å–lengthå’Œdataåœ°å€ï¼Œfridaä»£ç å¦‚ä¸‹ï¼š

```javascript
function todoOndlopen(libraryName, fn) {
    return new Promise((resolve, reject) =&gt; {
        var exportName = Java.androidVersion &gt;= 8.1 ? &#39;android_dlopen_ext&#39; : &#39;dlopen&#39;;
        var dlopen_ptr = Module.findExportByName(null, exportName);
        if (dlopen_ptr) {
            Interceptor.attach(dlopen_ptr, {
                onEnter: function (args) {
                    var libPath = args[0].readCString();
                    if (libPath.indexOf(libraryName) !== -1) {
                        console.log(`libraryPath: ${libPath}`);
                        this.hook = true
                    }
                },
                onLeave: function (retVal) {
                    if (this.hook) {
                        this.hook = false;
                        console.log(&#39;hooking&#39;)
                        resolve(fn());
                    }
                }
            })
        } else {
            reject(exportName &#43; &#39; not found&#39;)
        }
    })
 }
 
 
 
 function hook(){
    const libraryName = &#39;libun1ksec.so&#39;;
    return todoOndlopen(libraryName, ()=&gt;{
        const libraryName = &#39;libun1ksec.so&#39;;
        let libso = Process.getModuleByName(libraryName);
        let buffer = null;
        var base_addr = Module.findBaseAddress(libraryName);

        Interceptor.attach(base_addr.add(0x30FA64), {
            onEnter: function(args) {
                this.length = args[1].add(8).readUInt() //è·å–dataéƒ¨åˆ†é•¿åº¦
                console.log(hexdump(args[1].add(16).readPointer(),{ length: this.length }))
            },
            onLeave: function (retVal) {
                console.log(&#39;on leave&#39;)
                
            }
        
    })
 })
}
 
 
 
 hook()
```

æˆåŠŸè·å–åºåˆ—åŒ–æ•°æ®çš„å†…å®¹ï¼š

![](https://p0.meituan.net/xianfu/16041c934c3506f5eee6d33983bebdfa353075.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

ä½¿ç”¨cyberchefè§£ç æˆåŠŸ

![](https://p1.meituan.net/xianfu/9668fcf6624526fa4b113adc6e5d7dba376570.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)


### Hook aesåŠ å¯†ç®—æ³•

çœ‹åˆ°ä¸€ä¸ªevpçš„åˆå§‹åŒ–æ–¹æ³•EVP_CipherInit_exã€‚

![](https://p1.meituan.net/xianfu/ff9a4d6e0b1f28ee1bf7bf096a07250f50611.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

ç¬¬å››ã€äº”å…¥å‚åˆ†åˆ«æ˜¯keyå’Œivï¼Œå¯¹ç…§ida

![](https://p0.meituan.net/xianfu/8e74b0a5be078774a779ae9d9572e84896154.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

å¤§è‡´èƒ½çŸ¥é“v30æ˜¯&ctxï¼Œv19æ˜¯åŠ å¯†æ¨¡å¼ aes-cbc-256ï¼Œv74æ˜¯keyï¼Œv73æ˜¯ivè¿™é‡Œéƒ½æ˜¯0ã€‚

key :

```
.rodata:0000000000220FBC xmmword_220FBC  DCB 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18
```
ä½†æ˜¯è¿™æ ·æ˜¯å› ä¸ºapkå†™çš„å¤ªç®€å•äº†ï¼Œè¿˜æ˜¯é€šè¿‡å†…å­˜å¸ƒå±€é‡Œçœ‹åˆ°è¿™äº›å®šä¹‰æ¯”è¾ƒå¥½ã€‚å®é™…ä¸Šåˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ä»¥åŠè·å–åŠ å¯†ç»“æœçš„æ–¹æ³•ï¼Œéƒ½åªæ˜¯æŠŠä¸€äº›å‚æ•°å±æ€§è®¾ç½®åˆ°ä¸Šä¸‹æ–‡&ctxä¸­è€Œå·²ã€‚æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ctxçš„ç»“æ„ä½“å®šä¹‰ï¼š

![](https://p1.meituan.net/xianfu/f7e986ab1b686386609fe136243b8492363994.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

é‚£ä¹ˆåœ¨ç¨‹åºè¿è¡Œåˆ° EVP_CipherUpdateå‡½æ•°æ—¶ï¼Œå°±å¯ä»¥è·å–args[0],æ ¹æ®ç»“æ„ä½“å®šä¹‰æ‰¾åˆ°keyå’Œivã€‚

![](https://p0.meituan.net/xianfu/96bab9652d09dcb2c359ed3e04dbfc65336912.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

ä½¿ç”¨fridaè¿›è¡Œinline hook

```javascript
        Interceptor.attach(base_addr.add(0x30FC04), {
            onEnter: function(args) {
			console.log(hexdump(args[0]))
            }
    })
```

![](https://p1.meituan.net/xianfu/2a6e68d1ce5a65e1a414f05005c8442e349173.png%40watermark=1&&object=L3dkY2Zsb3cvN2RiN2M4NTFjYmVjZDg4MTM1OTZjMTYzOWE2MzQ4MDM0MjY0LnBuZw==&p=8&t=90&x=10&y=10)

èƒ½çœ‹åˆ°æ˜æ–‡å­˜åœ¨é‡Œé¢æŸä¸ªåŒºåŸŸä½ç½®ï¼Œå…¶ä»–éœ€è¦ç»“åˆç»“æ„ä½“å®šä¹‰æ¥çœ‹ã€‚åç»­åœ¨å®æˆ˜åˆ†æåŠ å¯†ç®—æ³•çš„æ—¶å€™å†ç»§ç»­æ·±å…¥ã€‚æœ¬ç« å®Œç»“ã€‚</textarea></div>


                <script>
                   $(function () {
                        
                        editormd.markdownToHTML("content");
                    })

                </script>




                </div>

                <hr>


                <div>
                    <h5>Â© ç‰ˆæƒå£°æ˜ï¼šéæ ‡æ³¨ã€è½¬è½½ã€æƒ…å†µä¸‹æœ¬æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œç‰ˆæƒå½’&nbsp;<a href="/">Depy's docs</a>&nbsp;æ‰€æœ‰ï¼Œè½¬è½½è¯·è”ç³»åšä¸»è·å¾—æˆæƒã€‚</h5>
                </div>

            </article>



    <div class="ad d-none d-lg-block">

        <div style="margin-left: 20px;margin-bottom:15px;font-weight:bold"> ã€ç›®å½•ã€ </div>
    <div class="anchorContent" id="anchorContent"> </div>
                       </div>

            </div>
    </section>
    <button class="sidebar-toggle sidebar-toggle-button" aria-label="Menu">
        <div><span></span><span></span><span></span></div>
    </button>

</main>

<link href="https://file.depy.ink/theme/docs/css/prettify.css?v=5530" rel="stylesheet">
<script src="https://file.depy.ink/theme/docs/js/prettify.js?v=5764"></script>
<script src="https://file.depy.ink/theme/docs/js/view.js?v=4125"></script>



<script>


    
    function addWatermark({
        container = document.body, 
        width = "220px", 
        height = "160px", 
        textAlign = "center", 
        textBaseline = "middle", 
        font = "16px Microsoft Yahei", 
        fillStyle = "rgba(184, 184, 184, 0.6)", 
        content = "depy|rce.ink", 
        rotate = "45", 
        zIndex = 10000, 
    }) {
        
        const canvas = document.createElement("canvas");
        canvas.setAttribute("width", width);
        canvas.setAttribute("height", height);
        const ctx = canvas.getContext("2d");
        ctx.textAlign = textAlign;
        ctx.textBaseline = textBaseline;
        ctx.font = font;
        ctx.fillStyle = fillStyle;
        ctx.rotate((Math.PI / 180) * rotate);
        ctx.fillText(content, parseFloat(width) / 2, parseFloat(height) / 2);

        
        const base64Url = canvas.toDataURL();
        const __wm = document.querySelector('.__wm');
        const watermarkDiv = __wm || document.createElement("div");
        const styleStr = `
                    position: fixed;
                    top: -70px;
                    left: 0;
                    bottom: 0;
                    right: 0;
                    width: 100%;
                    height: 100%;
                    z-index: ${zIndex};
                    pointer-events: none;
                    background-repeat: repeat;
                    background-image: url('${base64Url}')
                `;
        watermarkDiv.setAttribute("style", styleStr);
        watermarkDiv.classList.add("__wm");
        

        if (!__wm) {
            container.style.position = 'relative';
            container.insertBefore(watermarkDiv, container.firstChild);
        }
            
            const MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
            if (MutationObserver) {
                let mo = new MutationObserver(function () {
                    const __wm = document.querySelector('.__wm');
                    
                    if ((__wm && __wm.getAttribute('style') !== styleStr) || !__wm) {
                        
                        mo.disconnect();
                        mo = null;
                        console.log('1');
                        addWatermark({
                            container: document.getElementById("watermark"),
                            width: "220px",
                            height: "160px",
                            textAlign: "center",
                            textBaseline: "middle",
                            font: "16px Microsoft Yahei",
                            fillStyle: "rgba(184, 184, 184, 0.3 )",
                            content: "depy|rce.ink",
                            rotate: "30",
                            zIndex: 10000,
                        });
                    }
                });

                mo.observe(container, {
                    attributes: true,
                    subtree: true,
                    childList: true
                });
            }
    }



    function addwm(){
    addWatermark({
        container: document.getElementById("watermark"),
        width: "220px",
        height: "160px",
        textAlign: "center",
        textBaseline: "middle",
        font: "16px Microsoft Yahei",
        fillStyle: "rgba(184, 184, 184, 0.3 )",
        content: "depy|rce.ink",
        rotate: "30",
        zIndex: 10000,
    });
}

addwm();
</script>

</body>
</html>